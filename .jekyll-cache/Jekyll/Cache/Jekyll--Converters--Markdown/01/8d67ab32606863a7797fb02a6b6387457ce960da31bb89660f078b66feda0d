I"ˆ<p>This post describes how to emulate an Arm 64 (aarch64) or Arm hard float (armhf) using
using <code class="language-plaintext highlighter-rouge">qemu</code> and install Debian Linux on the emulator.</p>

<p>I used Ubuntu 18.04.5 but any Debian/Ubuntu distribution can be used with minor changes. Note that this didn‚Äôt work under VirtualBox but a USB-bootable Ubuntu distribution should be fine.</p>

<h1 id="for-64-bit-aarch64">For (64-bit) aarch64</h1>
<p>I used</p>
<pre><code class="language-http://debian.mirror.digitalpacific.com.au/debian-cd/10.9.0/arm64/iso-cd/```.">
</code></pre>
<p>qemu-system-aarch64     -cpu cortex-a53 -M virt -m 4096 -nographic     -bios /usr/share/qemu-efi-aarch64/QEMU_EFI.fd    -drive if=virtio,file=debian-3607.qcow2     -cdrom debian-10.9.0-arm64-xfce-CD-1.iso 
mount /dev/vdb /cdrom</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
# For (32-bit) armhf

## Install Debian on qemu-system-arm
Install qemu.
</code></pre></div></div>
<p>sudo apt update
sudo apt upgrade
mkdir qemu; cd qemu
sudo apt install qemu-system-arm</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Download [initrd.gz](http://ftp.debian.org/debian/dists/buster/main/installer-armhf/20190702/images/netboot/initrd.gz), [vmlinuz](http://ftp.debian.org/debian/dists/buster/main/installer-armhf/20190702/images/netboot/vmlinuz) and
[debian-10.9.0-armhf-netinst.iso](http://debian.mirror.digitalpacific.com.au/debian-cd/10.9.0/armhf/iso-cd/debian-10.9.0-armhf-netinst.iso)
(alternatively
[debian-10.9.0-armhf-xfce-CD-1.iso](http://debian.mirror.digitalpacific.com.au/debian-cd/10.9.0/armhf/iso-cd/debian-10.9.0-armhf-xfce-CD-1.iso)).
</code></pre></div></div>
<p>wget http://ftp.debian.org/debian/dists/buster/main/installer-armhf/20190702/images/netboot/initrd.gz
wget http://ftp.debian.org/debian/dists/buster/main/installer-armhf/20190702/images/netboot/vmlinuz
wget http://debian.mirror.digitalpacific.com.au/debian-cd/10.9.0/armhf/iso-cd/debian-10.9.0-armhf-netinst.iso</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>
<p>qemu-img create -f qcow2 debian-3607.qcow2 16G # 8G will also work but not leave enough disk space for other things
qemu-system-arm -M virt -kernel ./vmlinuz -initrd ./initrd.gz -hda debian-3607.qcow2 -nographic -m 1024M -append ‚Äúconsole=ttyAMA0‚Äù -drive file=debian-10.9.0-armhf-netinst.iso,id=cdrom,if=none,media=cdrom -device virtio-scsi-device -device scsi-cd,drive=cdrom
``</p>

<p>Use all of the defaults for the Debian installer.</p>
<ul>
  <li>I used ‚Äúelec3607‚Äù for all user names and passwords.</li>
  <li>For partitioning select ‚ÄúGuided - use entire disk‚Äù. Note that this chooses /dev/vda2 for / (we will use this later).</li>
  <li>If you get a ‚ÄúFailed to install the base system‚Äù message, try a second time from the menu.</li>
  <li>Select linux-image-armmp-lpae for the kernel.</li>
  <li>Select targeted for initrd <strong>(This was a mistake, choose generic)</strong></li>
  <li>For software to install, just choose ‚ÄúSSH server‚Äù and ‚Äústandard system utilities‚Äù (the default).</li>
  <li>You will receive the message that GRUB installation failed. We will fix this later.</li>
  <li>Exit <code class="language-plaintext highlighter-rouge">qemu</code> with ‚Äúcontrol-A x‚Äù.</li>
</ul>

<p>Extract the kernel and initrd from the disk image.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install libguestfs-tools
virt-ls -a debian-3607.qcow2 /boot/
virt-copy-out -a debian-3607.qcow2 /boot/vmlinuz-4.19.0-16-armmp-lpae /boot/initrd.img-4.19.0-16-armmp-lpae .
</code></pre></div></div>

<p>Now you can run your Debian-Arm Linux from either Linux:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qemu-system-arm -M virt -kernel vmlinuz-4.19.0-16-armmp-lpae -initrd initrd.img-4.19.0-16-armmp-lpae \
-append 'root=/dev/vda2' -drive if=virtio,file=debian-3607-lab4sol.qcow2,format=qcow2,id=hd \
-nographic -net user,hostfwd=tcp::10022-:22 -net nic
</code></pre></div></div>

<h2 id="install-sudo-and-put-elec3607-in-the-sudo-group">Install sudo and put ELEC3607 in the sudo group</h2>
<p>Login as <code class="language-plaintext highlighter-rouge">elec3607</code> (password is <code class="language-plaintext highlighter-rouge">elec3607</code>) and execute the following commands.
Note that the basic distribution of Debian does not include sudo.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>elec3607@debian:~$ su -
Password: 
root@debian:~# apt install sudo 
Reading package lists... Done
...
usermod -G sudo elec3607
shutdown now
</code></pre></div></div>

<h2 id="install-everything-else">Install everything else</h2>
<p>The complete list of Debian packages is available <a href="https://www.debian.org/distrib/packages">here</a>.
For example to install the alsa and pulseaudio packages.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install libasound2 libasound2-plugins libasound2-doc alsa-utils pulseaudio
</code></pre></div></div>
:ET