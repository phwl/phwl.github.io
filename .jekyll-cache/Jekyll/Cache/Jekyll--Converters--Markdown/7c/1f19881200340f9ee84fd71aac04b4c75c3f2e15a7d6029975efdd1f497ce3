I"4
<h3 id="14-manually-programming-the-clock-generator">1.4. Manually Programming the Clock Generator</h3>
<p>In many applications, one would want to calculate the Si5351 registers for a given type of output at runtime. An example would be say in a radio where the user selects the frequency (perhaps via a dial). <a href="https://www.silabs.com/documents/public/application-notes/AN619.pdf">Application Note AN619</a> details the process of calculating the header file used in Clock Builder.</p>

<p>Referring to the block diagram from the data sheet, following the input clock generator there are two stages, Stage 1 (feedback multisynth divider or FMD) and Stage 2 (output multisynth divider or OMD).</p>

<figure class="">
  <a href="/assets/images/2021/03/si5351-bdiagram.png">
  <img src="/assets/images/2021/03/si5351-bdiagram.png" alt="" />
  
    <figcaption>
      

    </figcaption></a></figure>

<p>Stage 1 simply multiplies the input oscillator frequency, $f_{XTAL}$ to the voltage controlled oscillator (VCO) value:</p>

\[f_{VCO} = \alpha f_{XTAL}\]

<p>As this is a hardware implementation, there are some constraints that need to be imposed. Firstly, $600 MHz \le f_{VCO} &lt; 900 MHz$
as that is the optional range of the VCO. Secondly,  $\alpha$ is computed from integer components $a, b$, and $c$.</p>

\[\alpha = (a + \frac{b}{c}),\]

<p>with $15 \le a \le 90,\; 0 \le b \lt 2^{20},\; 0 \le c \lt 2^{20}$.</p>

<p>Stage 2 then divides $f_{VCO}$ to achieve the desired output frequency $f$:</p>

\[f = \frac{f_{VCO}}{\beta}\]

\[\beta = (d + \frac{e}{f}),\]

<p>with $15 \le a \le 90,\; 0 \le b \lt 2^{20},\; 0 \le c \lt 2^{20}$.</p>

<p>Although the App Note tries to be helpful, they don’t describe a synthesis strategy which works for
frequencies in the high frequency (HF) band which is 3-30 MHz, used by Hans Summers in <a href="http://www.qrp-labs.com/images/synth/demo1/si5351a.c">this code</a>.</p>

<p>A higher $f_{VCO}$ gives more flexibility when we divide it down later so one approach is to set $f_{VCO}$ to a value which is just under the maximum
value of 900 MHz. Thus for a desired frequency $f$, we choose</p>

\[\beta' = \lfloor 900000000 / f \rfloor \text{ AND 0xFFFFFFFE}\]

<p>where the bitwise AND operation strips the least significant bit of $\beta’$ to make it an even number. Thus</p>

\[f_{VCO}' = \beta' f &lt; 900 MHz.\]

<p>Next we calculate</p>

\[\alpha' = \frac{f_{VCO}}{f_{XTAL}}\]

<p>and make $\alpha’ = a + b / c$ where $a= \lfloor \alpha’ \rfloor$, $c = 2^{20}-1$ is the largest 
20-bit denominator, and $b = round((\alpha’ - a) \times c)$.</p>

:ET