<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.6 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>BeagleBone Green GPIO - Life, the Universe and Fishing</title>
<meta name="description" content="This post details how to control the BeagleBone Green (BBG) via GPIO.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Life, the Universe and Fishing">
<meta property="og:title" content="BeagleBone Green GPIO">
<meta property="og:url" content="/2021/bbg-gpio/">


  <meta property="og:description" content="This post details how to control the BeagleBone Green (BBG) via GPIO.">



  <meta property="og:image" content="/assets/images/2021/02/bbg-photo.jpg">





  <meta property="article:published_time" content="2021-02-22T15:02:12+11:00">





  

  


<link rel="canonical" href="/2021/bbg-gpio/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "phwl",
      "url": "/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Life, the Universe and Fishing Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Life, the Universe and Fishing
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/archive" >Archive</a>
            </li><li class="masthead__menu-item">
              <a href="/gallery" >Gallery</a>
            </li><li class="masthead__menu-item">
              <a href="/research" >Research</a>
            </li><li class="masthead__menu-item">
              <a href="/about" >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="BeagleBone Green GPIO">
    <meta itemprop="description" content="This post details how to control the BeagleBone Green (BBG) via GPIO.">
    <meta itemprop="datePublished" content="February 22, 2021">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">BeagleBone Green GPIO
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>This post details how to control the BeagleBone Green (BBG) via GPIO.</p>

<h2 id="1-gpio">1. GPIO</h2>
<p>Since Linux v4.8, the standard way of using Linux GPIO has been via 
<a href="https://git.kernel.org/pub/scm/libs/libgpiod/libgpiod.git/">libgpiod</a>.
Prior to the introduction of libgpiod, the
sysfs interface was used, but sysfs is depreciated and was removed from the mainline Linux kernel
in 2020. 
The best source of information on libgpiod
<a href="https://git.kernel.org/pub/scm/libs/libgpiod/libgpiod.git/about/">comes with the library</a> and the (<a href="http://phwl.org/assets/images/2021/02/libgpiod-ref.pdf">libgpiod manual</a>).</p>

<p>The library comes with a number of command line tools to manipulate GPIOs:</p>
<ul>
  <li>
    <p>gpiodetect - list all gpiochips present on the system, their names, labels
            and number of GPIO lines</p>
  </li>
  <li>
    <p>gpioinfo   - list all lines of specified gpiochips, their names, consumers,
            direction, active state and additional flags</p>
  </li>
  <li>
    <p>gpioget    - read values of specified GPIO lines</p>
  </li>
  <li>
    <p>gpioset    - set values of specified GPIO lines, potentially keep the lines
            exported and wait until timeout, user input or signal</p>
  </li>
  <li>
    <p>gpiofind   - find the gpiochip name and line offset given the line name</p>
  </li>
  <li>
    <p>gpiomon    - wait for events on GPIO lines, specify which events to watch,
            how many events to process before exiting or if the events
            should be reported to the console.</p>
  </li>
</ul>

<p>Here are some usage examples from the Linux documentation (some like <code class="language-plaintext highlighter-rouge">gpiomon</code> won’t work on the BBG without an input source):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c"># Read the value of a single GPIO line.</span>
    <span class="nv">$ </span>gpioget gpiochip1 23
    0

    <span class="c"># Read two values at the same time. Set the active state of the lines</span>
    <span class="c"># to low.</span>
    <span class="nv">$ </span>gpioget <span class="nt">--active-low</span> gpiochip1 23 24
    1 1

    <span class="c"># Set values of two lines, then daemonize and wait for a signal (SIGINT or</span>
    <span class="c"># SIGTERM) before releasing them.</span>
    <span class="nv">$ </span>gpioset <span class="nt">--mode</span><span class="o">=</span>signal <span class="nt">--background</span> gpiochip1 <span class="nv">23</span><span class="o">=</span>1 <span class="nv">24</span><span class="o">=</span>0

    <span class="c"># Set the value of a single line, then exit immediately. This is useful</span>
    <span class="c"># for floating pins.</span>
    <span class="nv">$ </span>gpioset gpiochip1 <span class="nv">23</span><span class="o">=</span>1

    <span class="c"># Find a GPIO line by name.</span>
    <span class="nv">$ </span>gpiofind <span class="s2">"USR-LED-2"</span> gpiochip1 23

    <span class="c"># Toggle a GPIO by name, then wait for the user to press ENTER.</span>
    <span class="nv">$ </span>gpioset <span class="nt">--mode</span><span class="o">=</span><span class="nb">wait</span> <span class="sb">`</span>gpiofind <span class="s2">"USR-LED-2"</span><span class="sb">`</span><span class="o">=</span>1

    <span class="c"># Wait for three rising edge events on a single GPIO line, then exit.</span>
    <span class="nv">$ </span>gpiomon <span class="nt">--num-events</span><span class="o">=</span>3 <span class="nt">--rising-edge</span> gpiochip2 3
    event:  RISING EDGE offset: 3 timestamp: <span class="o">[</span>    1151.814356387]
    event:  RISING EDGE offset: 3 timestamp: <span class="o">[</span>    1151.815449803]
    event:  RISING EDGE offset: 3 timestamp: <span class="o">[</span>    1152.091556803]

    <span class="c"># Wait for a single falling edge event. Specify a custom output format.</span>
    <span class="nv">$ </span>gpiomon <span class="nt">--format</span><span class="o">=</span><span class="s2">"%e %o %s %n"</span> <span class="nt">--falling-edge</span> gpiochip1 4 0 4 1156 615459801

    <span class="c"># Pause execution until a single event of any type occurs. Don't print</span>
    <span class="c"># anything. Find the line by name.</span>
    <span class="nv">$ </span>gpiomon <span class="nt">--num-events</span><span class="o">=</span>1 <span class="nt">--silent</span> <span class="sb">`</span>gpiofind <span class="s2">"USR-IN"</span><span class="sb">`</span>

    <span class="c"># Monitor multiple lines, exit after the first event.</span>
    <span class="nv">$ </span>gpiomon <span class="nt">--silent</span> <span class="nt">--num-events</span><span class="o">=</span>1 gpiochip0 2 3 5
</code></pre></div></div>

<h2 id="2-laboratory-experiment">2. Laboratory Experiment</h2>
<h3 id="part-1---setup-10">Part 1 - Setup (10%)</h3>
<p>To use GPIO on the BBG, one must
first login to the beagleboard:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>phwl@PHWL-MBP lab1-gpio % ssh debian@beaglebone.local
Debian GNU/Linux 10

BeagleBoard.org Debian Buster IoT Image 2020-04-06

Support: http://elinux.org/Beagleboard:BeagleBoneBlack_Debian

default username:password is <span class="o">[</span>debian:temppwd]

debian@10.65.196.185<span class="s1">'s password: 

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Mar  3 04:58:05 2021 from 10.17.29.225
</span></code></pre></div></div>

<p>Then update the Debian package manager:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~<span class="nv">$ </span><span class="nb">sudo </span>apt update
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>debian: 
Hit:1 http://deb.debian.org/debian buster InRelease
Get:2 http://deb.debian.org/debian buster-updates InRelease <span class="o">[</span>51.9 kB]
Get:3 http://repos.rcn-ee.com/debian buster InRelease <span class="o">[</span>3,078 B]
Get:4 http://deb.debian.org/debian-security buster/updates InRelease <span class="o">[</span>65.4 kB]
Get:5 http://deb.debian.org/debian-security buster/updates/main armhf Packages <span class="o">[</span>262 kB]
Get:6 http://repos.rcn-ee.com/debian buster/main armhf Packages <span class="o">[</span>1,740 kB]     
Fetched 2,122 kB <span class="k">in </span>50s <span class="o">(</span>42.6 kB/s<span class="o">)</span>                                            
Reading package lists... Done
Building dependency tree       
Reading state information... Done
110 packages can be upgraded. Run <span class="s1">'apt list --upgradable'</span> to see them.
</code></pre></div></div>

<p>Now install the libgpiod library and git:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~<span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>libgpiod-dev git
Reading package lists... Done
Building dependency tree       
Reading state information... Done
libgpiod-dev is already the newest version <span class="o">(</span>1.4.1-2rcnee3~buster+20190906<span class="o">)</span><span class="nb">.</span>
Suggested packages:
  gettext-base git-daemon-run | git-daemon-sysvinit git-doc git-el git-email
  git-gui gitk gitweb git-cvs git-mediawiki git-svn
The following packages will be upgraded:
  git
1 upgraded, 0 newly installed, 0 to remove and 109 not upgraded.
Need to get 4,542 kB of archives.
After this operation, 50.2 kB of additional disk space will be used.
Do you want to <span class="k">continue</span>? <span class="o">[</span>Y/n] 
Get:1 http://deb.debian.org/debian buster/main armhf git armhf 1:2.20.1-2+deb10u3 <span class="o">[</span>4,542 kB]
Fetched 4,542 kB <span class="k">in </span>3s <span class="o">(</span>1,396 kB/s<span class="o">)</span>
<span class="o">(</span>Reading database ... 72582 files and directories currently installed.<span class="o">)</span>
Preparing to unpack .../git_1%3a2.20.1-2+deb10u3_armhf.deb ...
Unpacking git <span class="o">(</span>1:2.20.1-2+deb10u3<span class="o">)</span> over <span class="o">(</span>1:2.20.1-2+deb10u1<span class="o">)</span> ...
Setting up git <span class="o">(</span>1:2.20.1-2+deb10u3<span class="o">)</span> ...
</code></pre></div></div>

<p>Clone the starting files for this lab</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~<span class="nv">$ </span>git clone https://github.com/phwl/elec3607-labquestions.git
Cloning into <span class="s1">'elec3607-labquestions'</span>...
remote: Enumerating objects: 63, <span class="k">done</span><span class="nb">.</span>
remote: Counting objects: 100% <span class="o">(</span>63/63<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Compressing objects: 100% <span class="o">(</span>39/39<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Total 63 <span class="o">(</span>delta 21<span class="o">)</span>, reused 52 <span class="o">(</span>delta 13<span class="o">)</span>, pack-reused 0
Unpacking objects: 100% <span class="o">(</span>63/63<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
</code></pre></div></div>

<p>and install a Device Tree overlay to set the pinctl mode of the pins we will be
using to Mode 7 
(we will cover Device Trees later in this course):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~<span class="nv">$ </span><span class="nb">cd </span>elec3607-labquestions/labs/lab1-gpio/
debian@beaglebone:~/elec3607-labquestions/labs/lab1-gpio<span class="nv">$ </span>make <span class="nb">install
sudo cp </span>PHWL-GPIO-00A0.dtbo /lib/firmware
<span class="nb">sudo cp </span>uEnv.txt /boot
</code></pre></div></div>

<p>You will need to reboot the system for the Device Tree changes to take effect.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~/elec3607-labquestions/labs/lab1-gpio<span class="nv">$ </span><span class="nb">sudo </span>shutdown <span class="nt">-r</span> now
</code></pre></div></div>

<p>You can check everything is working by detecting the GPIO chips
and printing their labels and state.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~$ gpiodetect
gpiochip0 [gpio] (32 lines)
gpiochip1 [gpio] (32 lines)
gpiochip2 [gpio] (32 lines)
gpiochip3 [gpio] (32 lines)
debian@beaglebone:~$ gpioinfo
gpiochip0 - 32 lines:
	line   0:  "MDIO_DATA"       unused   input  active-high 
	line   1:   "MDIO_CLK"       unused   input  active-high 
...
</code></pre></div></div>

<p>Now turn on the D5 LED for 10 seconds using</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~<span class="nv">$ </span>gpioset <span class="nt">-m</span> <span class="nb">time</span> <span class="nt">-s</span> 10 gpiochip1 <span class="nv">24</span><span class="o">=</span>1
</code></pre></div></div>
<p>and turn it off for 10 seconds</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~$ gpioset -m time -s 10 gpiochip1 24=0
</code></pre></div></div>
<p>Note that after <code class="language-plaintext highlighter-rouge">gpioset</code> exits, the data of the output is undefined.</p>

<h3 id="part-2---s2-button-input-30">Part 2 - S2 Button Input (30%)</h3>
<p>Download, compile and execute the <code class="language-plaintext highlighter-rouge">blink</code> program which flashes the D5 LED as follows</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~/elec3607-labquestions/labs/lab1-gpio<span class="nv">$ </span><span class="nb">ls
</span>blink.c  Makefile  PHWL-GPIO-00A0.dtbo  PHWL-GPIO.dts  ssd.c
debian@beaglebone:~/elec3607-labquestions/labs/lab1-gpio<span class="nv">$ </span>make
cc    <span class="nt">-c</span> <span class="nt">-o</span> ssd.o ssd.c
gcc <span class="nt">-o</span> ssd ssd.c <span class="nt">-lgpiod</span>
cc    <span class="nt">-c</span> <span class="nt">-o</span> blink.o blink.c
gcc <span class="nt">-o</span> blink blink.c <span class="nt">-lgpiod</span>
dtc <span class="nt">-O</span> dtb <span class="nt">-o</span> PHWL-GPIO-00A0.dtbo <span class="nt">-b</span> 0 -@ PHWL-GPIO.dts
debian@beaglebone:~/elec3607-labquestions/labs/lab1-gpio<span class="nv">$ </span>./blink
</code></pre></div></div>

<p>Here is a listing of <code class="language-plaintext highlighter-rouge">blink.c</code></p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="code"><pre><span class="cm">/*
 * **    blink.c -    blink with 1s delay 
 * */</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;gpiod.h&gt;
</span>
<span class="cp">#define GPIOCHIP        1
#define GPIOLINE        24
</span>
<span class="kt">int</span> 
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
        <span class="k">struct</span> <span class="n">gpiod_chip</span> <span class="o">*</span><span class="n">output_chip</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">gpiod_line</span> <span class="o">*</span><span class="n">output_line</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">line_value</span><span class="p">;</span>

        <span class="cm">/* open chip and get line */</span>
        <span class="n">output_chip</span> <span class="o">=</span> <span class="n">gpiod_chip_open_by_number</span><span class="p">(</span><span class="n">GPIOCHIP</span><span class="p">);</span>
        <span class="n">output_line</span> <span class="o">=</span> <span class="n">gpiod_chip_get_line</span><span class="p">(</span><span class="n">output_chip</span><span class="p">,</span> <span class="n">GPIOLINE</span><span class="p">);</span>

        <span class="cm">/* config as output and set a description */</span>
        <span class="n">gpiod_line_request_output</span><span class="p">(</span><span class="n">output_line</span><span class="p">,</span> <span class="s">"blink"</span><span class="p">,</span> <span class="n">GPIOD_LINE_ACTIVE_STATE_HIGH</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(;;)</span>
        <span class="p">{</span>
                <span class="n">line_value</span> <span class="o">=</span> <span class="o">!</span><span class="n">line_value</span><span class="p">;</span>
                <span class="n">gpiod_line_set_value</span><span class="p">(</span><span class="n">output_line</span><span class="p">,</span> <span class="n">line_value</span><span class="p">);</span>
                <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Referring to the <a href="http://phwl.org/assets/images/2021/02/libgpiod-ref.pdf">libgpiod manual</a>, we obtain a descriptor for the chip specified by <code class="language-plaintext highlighter-rouge">GPIOCHIP</code> in line 20. Using that descriptor we obtain one for the line in line 21. 
In line 24, we configure the pin as an output, and give it the name “blink” (this is called a consumer in libgpiod). Line 28 toggles <code class="language-plaintext highlighter-rouge">line_value</code> between a true and false value, which is written to the line in line 29. We then sleep for 1 second before returning to the top of the infinite loop. You can press control-C to exit the program.</p>

<p>Modify the program so that, in addition to blinking the LED, it will
print the status of the S2 button once a second as below.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~<span class="nv">$ </span>./blink 
<span class="nv">S2</span><span class="o">=</span>1
...
<span class="nv">S2</span><span class="o">=</span>0
</code></pre></div></div>

<h3 id="part-3---seven-segment-display-60">Part 3 - Seven Segment Display (60%)</h3>

<figure class="">
  <a href="/assets/images/2021/02/ledres.jpg">
  <img src="/assets/images/2021/02/ledres.jpg" alt="" />
  
    <figcaption>
      

    </figcaption></a></figure>

<p>Here is a listing of <code class="language-plaintext highlighter-rouge">ssd.c</code>, a program to be completed in this exercise.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre></td><td class="code"><pre><span class="cm">/*
 * ssd.c -    count up and down on the SSD
 * 
*/</span>

<span class="cp">#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;gpiod.h&gt;
</span>
<span class="cm">/* the SSD is entirely on this chip */</span>
<span class="cp">#define OUT_GPIOCHIP	0
</span>
<span class="cm">/* the S2 button on the BBG */</span>
<span class="cp">#define	IN_GPIOCHIP		2
#define	IN_GPIOLINE		8
</span>
<span class="cp">#define	NELTS(x)	(sizeof(x) / sizeof(x[0]))	// calculate number of elements in x
#define	SEGMENTS	NELTS(gpiossd)
</span>
<span class="k">static</span> <span class="kt">int</span>	<span class="n">gpiossd</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">31</span> <span class="p">};</span>

<span class="cm">/* FILL THIS IN */</span>
<span class="k">static</span> <span class="kt">int</span>	<span class="n">ssd</span><span class="p">[][</span><span class="n">SEGMENTS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>	<span class="cm">/* 0 */</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>	<span class="cm">/* 1 */</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>	<span class="cm">/* 2 */</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>	<span class="cm">/* 3 */</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>	<span class="cm">/* 4 */</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>	<span class="cm">/* 5 */</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>	<span class="cm">/* 6 */</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>	<span class="cm">/* 7 */</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>	<span class="cm">/* 8 */</span>
	<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">};</span>	<span class="cm">/* 9 */</span>

<span class="kt">int</span> 
<span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="k">struct</span>	<span class="n">gpiod_chip</span> <span class="o">*</span><span class="n">output_chip</span><span class="p">;</span>
    <span class="k">struct</span>	<span class="n">gpiod_line</span> <span class="o">*</span><span class="n">output_line</span><span class="p">[</span><span class="n">SEGMENTS</span><span class="p">];</span>
	<span class="k">struct</span>	<span class="n">gpiod_chip</span> <span class="o">*</span><span class="n">input_chip</span><span class="p">;</span>
	<span class="k">struct</span>	<span class="n">gpiod_line</span> <span class="o">*</span><span class="n">input_line</span><span class="p">;</span>
    <span class="kt">int</span>		<span class="n">line_value</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

	<span class="cm">/* open input */</span>
	<span class="n">input_chip</span> <span class="o">=</span> <span class="n">gpiod_chip_open_by_number</span><span class="p">(</span><span class="n">IN_GPIOCHIP</span><span class="p">);</span>
	<span class="n">input_line</span> <span class="o">=</span> <span class="n">gpiod_chip_get_line</span><span class="p">(</span><span class="n">input_chip</span><span class="p">,</span> <span class="n">IN_GPIOLINE</span><span class="p">);</span>
	<span class="n">gpiod_line_request_input</span><span class="p">(</span><span class="n">input_line</span><span class="p">,</span> <span class="s">"ssd"</span><span class="p">);</span>

    <span class="cm">/* open /dev/gpiochip0 */</span>
    <span class="n">output_chip</span> <span class="o">=</span> <span class="n">gpiod_chip_open_by_number</span><span class="p">(</span><span class="n">OUT_GPIOCHIP</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SEGMENTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">output_line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpiod_chip_get_line</span><span class="p">(</span><span class="n">output_chip</span><span class="p">,</span> <span class="n">gpiossd</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="cm">/* config as output and set a description */</span>
		<span class="n">gpiod_line_request_output</span><span class="p">(</span><span class="n">output_line</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">"ssd"</span><span class="p">,</span> <span class="n">GPIOD_LINE_ACTIVE_STATE_HIGH</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>		<span class="cm">/* the digit to display */</span>
	<span class="k">for</span> <span class="p">(;;)</span> 
	<span class="p">{</span>
		<span class="cm">/* display all segments */</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">SEGMENTS</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
            <span class="cm">/* FILL THIS IN */</span>
		<span class="p">}</span>
        	<span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="cm">/* update count */</span>

        <span class="cm">/* FILL THIS IN */</span>
	<span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Refer to the <a href="http://exploringbeaglebone.com/wp-content/uploads/2019/01/533160-c06f009.png">Beaglebone P9 connector table</a> for the mapping of pins to the gpiochip0 lines.</p>

<p>The data sheet for a seven segment display (SSD) is available <a href="https://au.element14.com/broadcom-limited/5082-7613/led-display-0-3-he-red/dp/1175576">here</a>.</p>
<ul>
  <li>Calculate the resistor value so that the current to drive the LED (voltage is 3.3V-Vf where Vf=the diode forward voltage drop) doesn’t exceed 4mA.</li>
  <li>After studying <code class="language-plaintext highlighter-rouge">ssd.c</code>, connect up the SSD to the BBG via a breadboard.</li>
  <li>Complete the “FILL THIS IN” parts of <code class="language-plaintext highlighter-rouge">ssd.c</code> so the value changes in value 0 to 9 every second then goes back to 0. When S2 is pressed it should count backwards.</li>
</ul>

<p>Note that for the program to work, you will need to use the same GPIO lines as the program.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#beaglebone" class="page__taxonomy-item" rel="tag">beaglebone</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#embedded" class="page__taxonomy-item" rel="tag">embedded</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#academia" class="page__taxonomy-item" rel="tag">academia</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-02-22T15:02:12+11:00">February 22, 2021</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=BeagleBone+Green+GPIO%20%2F2021%2Fbbg-gpio%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=%2F2021%2Fbbg-gpio%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=%2F2021%2Fbbg-gpio%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2021/bbg-getting-started/" class="pagination--pager" title="BeagleBone Green Getting Started
">Previous</a>
    
    
      <a href="/2021/bbg-device-trees/" class="pagination--pager" title="BeagleBone Green Device Tree
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
      <a href="/2021/subaru-forster-cabinair-pollenfilter/">
        <img src=
          
            "/assets/images/2021/04/IMG_1897.jpg"
          
          alt="2016 Subaru Forester Cabin Air / Pollen Filter Replacement"></a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021/subaru-forster-cabinair-pollenfilter/" rel="permalink">2016 Subaru Forester Cabin Air / Pollen Filter Replacement
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">A few days ago I took our 2016 Subaru Forester for a service. They called me
back with the inspect report below, asking if I wanted to pay $143 for 
a replacement Cabin Air/Pollen filter.

  
  
  ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
      <a href="/2021/qemu-debian-audio/">
        <img src=
          
            "/assets/images/2021/02/bbg-photo.jpg"
          
          alt="Audio configuration under Debian QEMU"></a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021/qemu-debian-audio/" rel="permalink">Audio configuration under Debian QEMU
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">This post describes how to use audio on aarch64 ARM under
qemu Debian Linux. It follows from Debian on ARM via QEMU
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
      <a href="/2021/hawkesbury-river-rescue/">
        <img src=
          
            "/assets/images/2021/04/IMG_7692.jpeg"
          
          alt="Hawkesbury River Rescue"></a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021/hawkesbury-river-rescue/" rel="permalink">Hawkesbury River Rescue
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">It started off as a rather routine Easter fishing day trip to Mooney Mooney with Warren.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
      <a href="/2021/qemu-armhf-debian/">
        <img src=
          
            "/assets/images/2021/02/bbg-photo.jpg"
          
          alt="Debian on ARM via QEMU"></a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021/qemu-armhf-debian/" rel="permalink">Debian on ARM via QEMU
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">This post describes how to emulate an ARM 64 bit (aarch64) or ARM hard float 32 bit (armhf) processor using using qemu and install Debian Linux on the emulator. Actually I did the 32 bit one first ...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
          <li><a href="https://facebook.com/pleong" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/phwl" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://linkedin.com/in/philip-h-w-leong-949484" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin-f" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 phwl. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
