<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.6 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Beaglebone to Si5351 interface via i2c - Life, the Universe and Fishing</title>
<meta name="description" content="This post describes how to connect the BeagleBone to a Silicon LabsSi5351i2c clock generator.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Life, the Universe and Fishing">
<meta property="og:title" content="Beaglebone to Si5351 interface via i2c">
<meta property="og:url" content="/2021/beaglebone-interface-to-si5351-via-i2c/">


  <meta property="og:description" content="This post describes how to connect the BeagleBone to a Silicon LabsSi5351i2c clock generator.">



  <meta property="og:image" content="/assets/images/2021/02/bbg-photo.jpg">





  <meta property="article:published_time" content="2021-03-14T12:04:19+11:00">





  

  


<link rel="canonical" href="/2021/beaglebone-interface-to-si5351-via-i2c/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "phwl",
      "url": "/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Life, the Universe and Fishing Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Life, the Universe and Fishing
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/archive" >Archive</a>
            </li><li class="masthead__menu-item">
              <a href="/gallery" >Gallery</a>
            </li><li class="masthead__menu-item">
              <a href="/research" >Research</a>
            </li><li class="masthead__menu-item">
              <a href="/about" >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Beaglebone to Si5351 interface via i2c">
    <meta itemprop="description" content="This post describes how to connect the BeagleBone to a Silicon LabsSi5351i2c clock generator.">
    <meta itemprop="datePublished" content="March 14, 2021">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Beaglebone to Si5351 interface via i2c
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#1-introduction">1. Introduction</a>
    <ul>
      <li><a href="#11-i2c-interface-to-si5351">1.1 I2C Interface to Si5351</a></li>
      <li><a href="#12-linux-userspace-driver">1.2. Linux userspace driver</a></li>
      <li><a href="#13-programming-the-clock-generator">1.3. Programming the Clock Generator</a></li>
    </ul>
  </li>
  <li><a href="#2-laboratory-experiment">2. Laboratory Experiment</a>
    <ul>
      <li><a href="#part-1---i2c-interface-30">Part 1 - I2C Interface (30%)</a></li>
      <li><a href="#part-2---i2c-transaction-30">Part 2 - I2C Transaction (30%)</a></li>
      <li><a href="#part-3---si5351-configuration-40">Part 3 - Si5351 Configuration (40%)</a></li>
    </ul>
  </li>
</ul>
            </nav>
          </aside>
        
        <p>This post describes how to connect the BeagleBone to a Silicon Labs
<a href="https://www.silabs.com/documents/public/data-sheets/Si5351-B.pdf">Si5351</a>
i2c clock generator.</p>

<h2 id="1-introduction">1. Introduction</h2>
<h3 id="11-i2c-interface-to-si5351">1.1 I2C Interface to Si5351</h3>
<p>The i2c interface is simple, ensure that the SDA and SCL lines of
the Si5351 are connected to an appropriate port on the Beaglebone.
In the example below, I used /dev/i2c-2.</p>

<p>Then make sure all the software required is installed on the BBG.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt-get <span class="nb">install </span>libi2c-dev
</code></pre></div></div>

<p>The commands below show all the i2c devices and that the Si5351 
at address 0x60 is responding to the probe on I2C2 (i2c chip 2):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~$ i2cdetect -l
i2c-1	i2c       	OMAP I2C adapter                	I2C adapter
i2c-2	i2c       	OMAP I2C adapter                	I2C adapter
i2c-0	i2c       	OMAP I2C adapter                	I2C adapter
debian@beaglebone:~$ i2cdetect -y -r 2
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- -- 
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
60: 60 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
70: -- -- -- -- -- -- -- --                         
</code></pre></div></div>

<p>Here is part of the i2c transaction for <code class="language-plaintext highlighter-rouge">i2cdetect -y -r 2 0x60 0x60</code>.</p>

<figure class="">
  <a href="/assets/images/2021/03/si5351-i2c.jpg">
  <img src="/assets/images/2021/03/si5351-i2c.jpg" alt="" />
  
    <figcaption>
      

    </figcaption></a></figure>

<h3 id="12-linux-userspace-driver">1.2. Linux userspace driver</h3>

<p>There are several ways that this interface can be made. We are going
to create a userspace driver with the Linux  i2c-dev module
(which is the most straightforward approach). 
The following program, derived from the Linux Kernel <a href="https://www.kernel.org/doc/html/latest/i2c/dev-interface.html">userspace driver documentation</a> reads and prints register 0 of device /dev/i2c-2, address 0x60, i.e. register 0 of the Si5351. Note that the reason we need to specify address 0x60 is that there could be multiple devices connected to a single i2c chip.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="code"><pre><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;linux/i2c-dev.h&gt;
#include &lt;i2c/smbus.h&gt;
</span>
<span class="cp">#define	I2C_FNAME	"/dev/i2c-2"
#define	SI5351_ADDR	0x60
</span>
<span class="kt">int</span>	<span class="n">i2c_file</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">i2c_init</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">i2c_file</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="n">I2C_FNAME</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i2c_file</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">i2c_read</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ioctl</span><span class="p">(</span><span class="n">i2c_file</span><span class="p">,</span> <span class="n">I2C_SLAVE</span><span class="p">,</span> <span class="n">SI5351_ADDR</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> 
		<span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">res</span><span class="p">;</span>

	<span class="cm">/* Using SMBus commands */</span>
	<span class="n">res</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">i2c_file</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> 
		<span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="k">else</span> 
		<span class="n">printf</span><span class="p">(</span><span class="s">"r dev(0x%x) reg(0x%x)=0x%x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">SI5351_ADDR</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="n">i2c_init</span><span class="p">();</span>
	<span class="n">i2c_read</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>It can be compiled and executed as follows:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~<span class="nv">$ </span>gcc <span class="nt">-o</span> si5351 si5351.c <span class="nt">-li2c</span>
debian@beaglebone:~<span class="nv">$ </span>./si5351 
r dev<span class="o">(</span>0x60<span class="o">)</span> reg<span class="o">(</span>0x0<span class="o">)=</span>0x11
</code></pre></div></div>

<h3 id="13-programming-the-clock-generator">1.3. Programming the Clock Generator</h3>
<p>The <a href="https://www.silabs.com/documents/public/data-sheets/Si5351-B.pdf">data sheet</a> for the Si5351 refers to the <a href="https://www.silabs.com/developers/clockbuilder-pro-software">Clock builder</a> software. This is only available for Windows 
but in embedded systems it is a fact of life that if you use operating
system X, there will be a piece of software that is only supported on operating system Y that you need. Here
is a header file that I generated for CLK0 and CLK1 outputs of 28.1544 MHz.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
</pre></td><td class="code"><pre><span class="cm">/*
 * Si5351A Rev B Configuration Register Export Header File
 *
 * This file represents a series of Silicon Labs Si5351A Rev B 
 * register writes that can be performed to load a single configuration 
 * on a device. It was created by a Silicon Labs ClockBuilder Pro
 * export tool.
 *
 * Part:		                                       Si5351A Rev B
 * Design ID:                                          
 * Includes Pre/Post Download Control Register Writes: Yes
 * Created By:                                         ClockBuilder Pro v3.1 [2021-01-18]
 * Timestamp:                                          2021-03-12 15:00:15 GMT-08:00
 *
 * A complete design report corresponding to this export is included at the end 
 * of this header file.
 *
 */</span>

<span class="cp">#ifndef SI5351A_REVB_REG_CONFIG_HEADER
#define SI5351A_REVB_REG_CONFIG_HEADER
</span>
<span class="cp">#define SI5351A_REVB_REG_CONFIG_NUM_REGS				52
</span>
<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">address</span><span class="p">;</span> <span class="cm">/* 16-bit register address */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">value</span><span class="p">;</span> <span class="cm">/* 8-bit register data */</span>

<span class="p">}</span> <span class="n">si5351a_revb_register_t</span><span class="p">;</span>

<span class="n">si5351a_revb_register_t</span> <span class="k">const</span> <span class="n">si5351a_revb_registers</span><span class="p">[</span><span class="n">SI5351A_REVB_REG_CONFIG_NUM_REGS</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x0002</span><span class="p">,</span> <span class="mh">0x53</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0003</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0004</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0007</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x000F</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0010</span><span class="p">,</span> <span class="mh">0x0F</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0011</span><span class="p">,</span> <span class="mh">0x0F</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0012</span><span class="p">,</span> <span class="mh">0x8C</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0013</span><span class="p">,</span> <span class="mh">0x8C</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0014</span><span class="p">,</span> <span class="mh">0x8C</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0015</span><span class="p">,</span> <span class="mh">0x8C</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0016</span><span class="p">,</span> <span class="mh">0x8C</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0017</span><span class="p">,</span> <span class="mh">0x8C</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x001A</span><span class="p">,</span> <span class="mh">0xAF</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x001B</span><span class="p">,</span> <span class="mh">0xC8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x001C</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x001D</span><span class="p">,</span> <span class="mh">0x0E</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x001E</span><span class="p">,</span> <span class="mh">0x8D</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x001F</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0020</span><span class="p">,</span> <span class="mh">0x85</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0021</span><span class="p">,</span> <span class="mh">0x58</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x002A</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x002B</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x002C</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x002D</span><span class="p">,</span> <span class="mh">0x0D</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x002E</span><span class="p">,</span> <span class="mh">0xE0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x002F</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0030</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0031</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0032</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0033</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0034</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0035</span><span class="p">,</span> <span class="mh">0x0D</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0036</span><span class="p">,</span> <span class="mh">0xE0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0037</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0038</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0039</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x005A</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x005B</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0095</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0096</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0097</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0098</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0099</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x009A</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x009B</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00A2</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00A3</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00A4</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00A5</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00A6</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00B7</span><span class="p">,</span> <span class="mh">0x92</span> <span class="p">},</span>

<span class="p">};</span>

<span class="cm">/*
 * Design Report
 *
 * Overview
 * ========
 * Part:               Si5351A
 * Created By:         ClockBuilder Pro v3.1 [2021-01-18]
 * Timestamp:          2021-03-12 15:00:15 GMT-08:00
 * 
 * Design Notes
 * ============
 * Si5351A 10-pin MSOP
 * 
 * Design Rule Check
 * =================
 * Errors:
 * - No errors
 * 
 * Warnings:
 * - No warnings
 * 
 * Design
 * ======
 * Inputs:
 *     IN0: 27 MHz
 * 
 * Outputs:
 *    OUT0: 28.1544 MHz
 *          Enabled LVCMOS 8 mA
 *          Offset 0.000 s 
 *    OUT1: 28.1544 MHz
 *          Enabled LVCMOS 8 mA
 *          Offset 0.000 s 
 *    OUT2: Unused
 * 
 * Frequency Plan
 * ==============
 * PLL_A:
 *    Enabled Features = None
 *    Fvco             = 893.9022 MHz
 *    M                = 33.1074888888888888... [ 33 + 4837/45000 ]
 *    Input0:
 *       Source           = Crystal
 *       Source Frequency = 27 MHz
 *       Fpfd             = 27 MHz
 *       Load Capacitance = Load_08pF
 *    Output0:
 *       Features       = None
 *       Disabled State = StopLow
 *       R              = 1  (2^0)
 *       Fout           = 28.1544 MHz
 *       N              = 31.75
 *    Output1:
 *       Features       = None
 *       Disabled State = StopLow
 *       R              = 1  (2^0)
 *       Fout           = 28.1544 MHz
 *       N              = 31.75
 * 
 * Settings
 * ========
 * 
 * Location      Setting Name    Decimal Value      Hex Value        
 * ------------  --------------  -----------------  -----------------
 * 0x0002[3]     XO_LOS_MASK     0                  0x0              
 * 0x0002[4]     CLK_LOS_MASK    1                  0x1              
 * 0x0002[5]     LOL_A_MASK      0                  0x0              
 * 0x0002[6]     LOL_B_MASK      1                  0x1              
 * 0x0002[7]     SYS_INIT_MASK   0                  0x0              
 * 0x0003[7:0]   CLK_OEB         0                  0x00             
 * 0x0004[4]     DIS_RESET_LOLA  0                  0x0              
 * 0x0004[5]     DIS_RESET_LOLB  1                  0x1              
 * 0x0007[7:4]   I2C_ADDR_CTRL   0                  0x0              
 * 0x000F[2]     PLLA_SRC        0                  0x0              
 * 0x000F[3]     PLLB_SRC        0                  0x0              
 * 0x000F[4]     PLLA_INSELB     0                  0x0              
 * 0x000F[5]     PLLB_INSELB     0                  0x0              
 * 0x000F[7:6]   CLKIN_DIV       0                  0x0              
 * 0x0010[1:0]   CLK0_IDRV       3                  0x3              
 * 0x0010[3:2]   CLK0_SRC        3                  0x3              
 * 0x0010[4]     CLK0_INV        0                  0x0              
 * 0x0010[5]     MS0_SRC         0                  0x0              
 * 0x0010[6]     MS0_INT         0                  0x0              
 * 0x0010[7]     CLK0_PDN        0                  0x0              
 * 0x0011[1:0]   CLK1_IDRV       3                  0x3              
 * 0x0011[3:2]   CLK1_SRC        3                  0x3              
 * 0x0011[4]     CLK1_INV        0                  0x0              
 * 0x0011[5]     MS1_SRC         0                  0x0              
 * 0x0011[6]     MS1_INT         0                  0x0              
 * 0x0011[7]     CLK1_PDN        0                  0x0              
 * 0x0012[1:0]   CLK2_IDRV       0                  0x0              
 * 0x0012[3:2]   CLK2_SRC        3                  0x3              
 * 0x0012[4]     CLK2_INV        0                  0x0              
 * 0x0012[5]     MS2_SRC         0                  0x0              
 * 0x0012[6]     MS2_INT         0                  0x0              
 * 0x0012[7]     CLK2_PDN        1                  0x1              
 * 0x0013[1:0]   CLK3_IDRV       0                  0x0              
 * 0x0013[3:2]   CLK3_SRC        3                  0x3              
 * 0x0013[4]     CLK3_INV        0                  0x0              
 * 0x0013[5]     MS3_SRC         0                  0x0              
 * 0x0013[6]     MS3_INT         0                  0x0              
 * 0x0013[7]     CLK3_PDN        1                  0x1              
 * 0x0014[1:0]   CLK4_IDRV       0                  0x0              
 * 0x0014[3:2]   CLK4_SRC        3                  0x3              
 * 0x0014[4]     CLK4_INV        0                  0x0              
 * 0x0014[5]     MS4_SRC         0                  0x0              
 * 0x0014[6]     MS4_INT         0                  0x0              
 * 0x0014[7]     CLK4_PDN        1                  0x1              
 * 0x0015[1:0]   CLK5_IDRV       0                  0x0              
 * 0x0015[3:2]   CLK5_SRC        3                  0x3              
 * 0x0015[4]     CLK5_INV        0                  0x0              
 * 0x0015[5]     MS5_SRC         0                  0x0              
 * 0x0015[6]     MS5_INT         0                  0x0              
 * 0x0015[7]     CLK5_PDN        1                  0x1              
 * 0x0016[1:0]   CLK6_IDRV       0                  0x0              
 * 0x0016[3:2]   CLK6_SRC        3                  0x3              
 * 0x0016[4]     CLK6_INV        0                  0x0              
 * 0x0016[5]     MS6_SRC         0                  0x0              
 * 0x0016[6]     FBA_INT         0                  0x0              
 * 0x0016[7]     CLK6_PDN        1                  0x1              
 * 0x0017[1:0]   CLK7_IDRV       0                  0x0              
 * 0x0017[3:2]   CLK7_SRC        3                  0x3              
 * 0x0017[4]     CLK7_INV        0                  0x0              
 * 0x0017[5]     MS7_SRC         0                  0x0              
 * 0x0017[6]     FBB_INT         0                  0x0              
 * 0x0017[7]     CLK7_PDN        1                  0x1              
 * 0x001C[17:0]  MSNA_P1         3725               0x00E8D          
 * 0x001F[19:0]  MSNA_P2         34136              0x08558          
 * 0x001F[23:4]  MSNA_P3         45000              0x0AFC8          
 * 0x002C[17:0]  MS0_P1          3552               0x00DE0          
 * 0x002F[19:0]  MS0_P2          0                  0x00000          
 * 0x002F[23:4]  MS0_P4          4                  0x00004          
 * 0x0034[17:0]  MS1_P1          3552               0x00DE0          
 * 0x0037[19:0]  MS1_P2          0                  0x00000          
 * 0x0037[23:4]  MS1_P4          4                  0x00004          
 * 0x005A[7:0]   MS6_P2          0                  0x00             
 * 0x005B[7:0]   MS7_P2          0                  0x00             
 * 0x0095[14:0]  SSDN_P2         0                  0x0000           
 * 0x0095[7]     SSC_EN          0                  0x0              
 * 0x0097[14:0]  SSDN_P3         0                  0x0000           
 * 0x0097[7]     SSC_MODE        0                  0x0              
 * 0x0099[11:0]  SSDN_P1         0                  0x000            
 * 0x009A[15:4]  SSUDP           0                  0x000            
 * 0x00A2[21:0]  VCXO_PARAM      0                  0x000000         
 * 0x00A5[7:0]   CLK0_PHOFF      0                  0x00             
 * 0x00A6[7:0]   CLK1_PHOFF      0                  0x00             
 * 0x00B7[7:6]   XTAL_CL         2                  0x2
 * 
 *
 */</span>

<span class="cp">#endif</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Our approach will be to use the header file above as well as the information from <a href="https://www.silabs.com/documents/public/application-notes/AN619.pdf">Application Note AN619</a>. The programming procedure is described in Figure 10 of the <a href="https://www.silabs.com/documents/public/data-sheets/Si5351-B.pdf">data sheet</a>, summarised below.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ClockBuilder Desktop allows a user to generate RAM configuration files to program the Si5351 with custom frequency plans via I2C.  Once the register map has been generated, use the procedure below to program the device.

1. Disable all outputs.
       reg3 = 0xFF
2. Power down all output drivers
       reg 16 = 0x80*
       reg 17 = 0x80*
       reg 18 = 0x80*
       reg 19 = 0x80*
       reg 20 = 0x80*
       reg 21 = 0x80*
       reg 22 = 0x80*
       reg 23 = 0x80*
       * If using the Si5351C with no crystal present on XA/XB, set reg16-23 = 0x84.
3. Set interrupt maks register (see Register 2 description in datasheet)
4. If needed, set crystal load capacitance, XTAL_CL in reg183[7:6].  See datasheet for register description.
5. Write registers 15-92 and 149-170 using the contents of register map generated by ClockBuilder Desktop.
6. Apply PLL A and PLL B soft reset.
       reg177 = 0xAC
7. Enable outputs with OEB control in register 3.
</code></pre></div></div>

<p>If these steps are followed, the output as specified in the include file
should appear. It doesn’t look much like a square wave on my 150 MHz 
bandwidth oscilloscope. Why?</p>

<figure class="">
  <a href="/assets/images/2021/03/si5351-osc.jpg">
  <img src="/assets/images/2021/03/si5351-osc.jpg" alt="" />
  
    <figcaption>
      

    </figcaption></a></figure>

<p>Finally, we wish to have the inphase (I) clock (CLK0) lagging the quadrature (Q) clock (CLK1) by 90 degrees (or 1/4 cycle). We can do this by setting the CLK1_PHOFF register to the appropriate value.</p>

<h2 id="2-laboratory-experiment">2. Laboratory Experiment</h2>
<p>Update the lab files as below.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~<span class="nv">$ </span><span class="nb">cd </span>elec3607-labquestions/
debian@beaglebone:~/elec3607-labquestions<span class="nv">$ </span>git pull
remote: Enumerating objects: 18, <span class="k">done</span><span class="nb">.</span>
remote: Counting objects: 100% <span class="o">(</span>18/18<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Compressing objects: 100% <span class="o">(</span>12/12<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Total 14 <span class="o">(</span>delta 2<span class="o">)</span>, reused 14 <span class="o">(</span>delta 2<span class="o">)</span>, pack-reused 0
Unpacking objects: 100% <span class="o">(</span>14/14<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
From https://github.com/phwl/elec3607-labquestions
   6bf3a34..7c881d4  main       -&gt; origin/main
Updating 6bf3a34..7c881d4
Fast-forward
 .DS_Store                                          | Bin 6148 -&gt; 6148 bytes
 labs/.DS_Store                                     | Bin 0 -&gt; 8196 bytes
 ... - GPIO_ ELEC3607 ELEC9607 Embedded Systems.pdf | Bin 0 -&gt; 297484 bytes
 ...ruction_ ELEC3607 ELEC9607 Embedded Systems.pdf | Bin 0 -&gt; 156733 bytes
 ...nerator_ ELEC3607 ELEC9607 Embedded Systems.pdf | Bin 0 -&gt; 2310302 bytes
 labs/lab3-i2c/Makefile                             |   7 +
 labs/lab3-i2c/Si5351A-RevB-Registers.h             | 240 +++++++++++++++++++++
 labs/lab3-i2c/si5351.c                             |  41 ++++
 8 files changed, 288 insertions<span class="o">(</span>+<span class="o">)</span>
 create mode 100644 labs/.DS_Store
 create mode 100644 labs/lab1-gpio/Lab 1 - GPIO_ ELEC3607 ELEC9607 Embedded Systems.pdf
 create mode 100644 labs/lab2-sdrconstruction/Lab 2 - SDR Construction_ ELEC3607 ELEC9607 Embedded Systems.pdf
 create mode 100644 labs/lab3-i2c/Lab 3 - Si5351 Clock Generator_ ELEC3607 ELEC9607 Embedded Systems.pdf
 create mode 100644 labs/lab3-i2c/Makefile
 create mode 100755 labs/lab3-i2c/Si5351A-RevB-Registers.h
 create mode 100644 labs/lab3-i2c/si5351.c
debian@beaglebone:~/elec3607-labquestions<span class="nv">$ </span><span class="nb">cd </span>labs/lab3-i2c/
debian@beaglebone:~/elec3607-labquestions/labs/lab3-i2c<span class="err">$</span>
</code></pre></div></div>
<h3 id="part-1---i2c-interface-30">Part 1 - I2C Interface (30%)</h3>
<p>Connect up your BBG to the Si5351. Verify that you can obtain
the following output.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>debian@beaglebone:~$ i2cdetect -y -r 2
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- -- 
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
60: 60 -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 
70: -- -- -- -- -- -- -- --                         
</code></pre></div></div>

<h3 id="part-2---i2c-transaction-30">Part 2 - I2C Transaction (30%)</h3>
<p>Use the userspace i2c driver (<code class="language-plaintext highlighter-rouge">si5351.c</code>) shown above to read register 0.
Execute the program and capture the activity of the SCL and SDA pins on an oscilloscope. Make a printout of the oscilloscope display and annotate all parts of 
the i2c transaction (start, data, r/w, ack, etc). What is the period of the entire transaction?</p>

<h3 id="part-3---si5351-configuration-40">Part 3 - Si5351 Configuration (40%)</h3>
<p>Modify the userspace driver for the Si5351 to generate a 7 MHz square wave output on CLK0 and CLK1, with CLK1 being delayed by 90 degrees from CLK0.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#beaglebone" class="page__taxonomy-item" rel="tag">beaglebone</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#embedded" class="page__taxonomy-item" rel="tag">embedded</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#academia" class="page__taxonomy-item" rel="tag">academia</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-03-14T12:04:19+11:00">March 14, 2021</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Beaglebone+to+Si5351+interface+via+i2c%20%2F2021%2Fbeaglebone-interface-to-si5351-via-i2c%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=%2F2021%2Fbeaglebone-interface-to-si5351-via-i2c%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=%2F2021%2Fbeaglebone-interface-to-si5351-via-i2c%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2021/connecting-beaglebone-to-internet/" class="pagination--pager" title="Connecting the Beaglebone to Internet
">Previous</a>
    
    
      <a href="/2021/building-bbg-kernel/" class="pagination--pager" title="Building the Beaglebone kernel
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
      <a href="/2021/qemu-armhf-debian/">
        <img src=
          
            "/assets/images/2021/02/bbg-photo.jpg"
          
          alt="Debian on armhf emulation via QEMU"></a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021/qemu-armhf-debian/" rel="permalink">Debian on armhf emulation via QEMU
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">This post describes how to emulate an Arm hard float (armhf) using
using qemu and install Debian Linux on the emulator.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
      <a href="/2021/trailer-bearings/">
        <img src=
          
            "https://www.mywestshore.com/wp-content/uploads/2018/04/Boat-Trailer-Bearing.jpg"
          
          alt="Trailer Bearings"></a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021/trailer-bearings/" rel="permalink">Trailer Bearings
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Here is how you tell what types of trailer bearings you have without taking them out.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
      <a href="/2021/building-bbg-kernel/">
        <img src=
          
            "/assets/images/2021/02/bbg-photo.jpg"
          
          alt="Building the Beaglebone kernel"></a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021/building-bbg-kernel/" rel="permalink">Building the Beaglebone kernel
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">This post describes how to cross compile the Beaglebone Black (BBB) or Beaglebone Green (BBG) Linux kernel on an Ubuntu 18.04 Linux machine.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
      <a href="/2021/connecting-beaglebone-to-internet/">
        <img src=
          
            "/assets/images/2021/02/bbg-photo.jpg"
          
          alt="Connecting the Beaglebone to Internet"></a>
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021/connecting-beaglebone-to-internet/" rel="permalink">Connecting the Beaglebone to Internet
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">This post describes how to connect the BeagleBone to the Internet via
Ethernet on Windows and MacOS.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
          <li><a href="https://facebook.com/pleong" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/phwl" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://linkedin.com/in/philip-h-w-leong-949484" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin-f" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 phwl. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
