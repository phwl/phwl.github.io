<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.1.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2021-01-13T22:35:02+11:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Life, the Universe and Fishing</title><subtitle>Random things.</subtitle><author><name>phwl</name></author><entry><title type="html">GPIO on QEMU ARM Linux</title><link href="http://localhost:4000/2021/QEMU-ARM-Linux-gpio/" rel="alternate" type="text/html" title="GPIO on QEMU ARM Linux" /><published>2021-01-09T21:26:12+11:00</published><updated>2021-01-09T21:26:12+11:00</updated><id>http://localhost:4000/2021/QEMU-ARM-Linux-gpio</id><content type="html" xml:base="http://localhost:4000/2021/QEMU-ARM-Linux-gpio/">&lt;p&gt;This post details how to use the GPIO peripheral on the ARM linux image 
built in &lt;a href=&quot;/2021/emulated-ARM-Linux-with-Buildroot-and-QEMU/&quot;&gt;Creating an emulated ARM Linux system using Buildroot and QEMU&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;1-linux-libgpiod-library-command-line-tools&quot;&gt;1. Linux libgpiod Library Command Line Tools&lt;/h2&gt;
&lt;p&gt;Since Linux v4.8, the standard way of using Linux GPIO has been via 
&lt;a href=&quot;https://git.kernel.org/pub/scm/libs/libgpiod/libgpiod.git/&quot;&gt;libgpiod&lt;/a&gt;.
Prior to the introduction of libgpiod, the
sysfs interface was used, but sysfs is depreciated and was removed from the mainline Linux kernel
in 2020. 
The best source of information on libgpiod
&lt;a href=&quot;https://git.kernel.org/pub/scm/libs/libgpiod/libgpiod.git/about/&quot;&gt;comes with the library&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here is a summary of the command line tools that it comes with:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;gpiodetect - list all gpiochips present on the system, their names, labels
            and number of GPIO lines&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;gpioinfo   - list all lines of specified gpiochips, their names, consumers,
            direction, active state and additional flags&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;gpioget    - read values of specified GPIO lines&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;gpioset    - set values of specified GPIO lines, potentially keep the lines
            exported and wait until timeout, user input or signal&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;gpiofind   - find the gpiochip name and line offset given the line name&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;gpiomon    - wait for events on GPIO lines, specify which events to watch,
            how many events to process before exiting or if the events
            should be reported to the console.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Examples (also from the documentation) of how they are used:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;c&quot;&gt;# Read the value of a single GPIO line.&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gpioget gpiochip1 23
    0

    &lt;span class=&quot;c&quot;&gt;# Read two values at the same time. Set the active state of the lines&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# to low.&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gpioget &lt;span class=&quot;nt&quot;&gt;--active-low&lt;/span&gt; gpiochip1 23 24
    1 1

    &lt;span class=&quot;c&quot;&gt;# Set values of two lines, then daemonize and wait for a signal (SIGINT or&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# SIGTERM) before releasing them.&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gpioset &lt;span class=&quot;nt&quot;&gt;--mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;signal &lt;span class=&quot;nt&quot;&gt;--background&lt;/span&gt; gpiochip1 &lt;span class=&quot;nv&quot;&gt;23&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 &lt;span class=&quot;nv&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0

    &lt;span class=&quot;c&quot;&gt;# Set the value of a single line, then exit immediately. This is useful&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# for floating pins.&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gpioset gpiochip1 &lt;span class=&quot;nv&quot;&gt;23&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1

    &lt;span class=&quot;c&quot;&gt;# Find a GPIO line by name.&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gpiofind &lt;span class=&quot;s2&quot;&gt;&quot;USR-LED-2&quot;&lt;/span&gt;
    gpiochip1 23

    &lt;span class=&quot;c&quot;&gt;# Toggle a GPIO by name, then wait for the user to press ENTER.&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gpioset &lt;span class=&quot;nt&quot;&gt;--mode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;wait&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;gpiofind &lt;span class=&quot;s2&quot;&gt;&quot;USR-LED-2&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1

    &lt;span class=&quot;c&quot;&gt;# Wait for three rising edge events on a single GPIO line, then exit.&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gpiomon &lt;span class=&quot;nt&quot;&gt;--num-events&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3 &lt;span class=&quot;nt&quot;&gt;--rising-edge&lt;/span&gt; gpiochip2 3
    event:  RISING EDGE offset: 3 timestamp: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    1151.814356387]
    event:  RISING EDGE offset: 3 timestamp: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    1151.815449803]
    event:  RISING EDGE offset: 3 timestamp: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    1152.091556803]

    &lt;span class=&quot;c&quot;&gt;# Wait for a single falling edge event. Specify a custom output format.&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gpiomon &lt;span class=&quot;nt&quot;&gt;--format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;%e %o %s %n&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--falling-edge&lt;/span&gt; gpiochip1 4
    0 4 1156 615459801

    &lt;span class=&quot;c&quot;&gt;# Pause execution until a single event of any type occurs. Don't print&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# anything. Find the line by name.&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gpiomon &lt;span class=&quot;nt&quot;&gt;--num-events&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 &lt;span class=&quot;nt&quot;&gt;--silent&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;gpiofind &lt;span class=&quot;s2&quot;&gt;&quot;USR-IN&quot;&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# Monitor multiple lines, exit after the first event.&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gpiomon &lt;span class=&quot;nt&quot;&gt;--silent&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--num-events&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 gpiochip0 2 3 5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;`&lt;/p&gt;

&lt;p&gt;Here we use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;libgpiod&lt;/code&gt; tools to determine there is one gpiochip (gpiochip0) and that they are initially all set as inputs. We can also see that while
gpio lines can have names, all of the ones on this machine are unnamed.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;phwl@bream:~/elec3607/buildroot/output/images$ H=~/elec3607
phwl@bream:~/elec3607/buildroot/output/images$ cd $H/buildroot/output/images
phwl@bream:~/elec3607/buildroot/output/images$ ./start-qemu.sh 
Booting Linux on physical CPU 0x0000000000 [0x410fd034]
... sh
Welcome to Buildroot
buildroot login: root
# gpiodetect 
gpiochip0 [9030000.pl061] (8 lines)
# gpioinfo
gpiochip0 - 8 lines:
	line   0:      unnamed       unused   input  active-high 
	line   1:      unnamed       unused   input  active-high 
	line   2:      unnamed       unused   input  active-high 
	line   3:      unnamed       unused   input  active-high 
	line   4:      unnamed       unused   input  active-high 
	line   5:      unnamed       unused   input  active-high 
	line   6:      unnamed       unused   input  active-high 
	line   7:      unnamed       unused   input  active-high 
# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is a link to a tutorial explaining the
changes
&lt;a href=&quot;https://microhobby.com.br/blog/2020/02/02/new-linux-kernel-5-5-new-interfaces-in-gpiolib/&quot;&gt;https://microhobby.com.br/blog/2020/02/02/new-linux-kernel-5-5-new-interfaces-in-gpiolib/&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;2-blink&quot;&gt;2. Blink&lt;/h2&gt;

&lt;h3 id=&quot;21-using-gpiod&quot;&gt;2.1 Using gpiod&lt;/h3&gt;
&lt;p&gt;Using the gpiod library, 
the following program will change the state of pin 3 on gpiochip0 ten times.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cm&quot;&gt;/*
**    blink.c -    blink gpiochip0 line 3 with delay given by either
**                 the command line or the default (NSPERIOD)
*/&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;gpiod.h&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define NSPERIOD    200000000ULL    &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;/* output period in ns */&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; 
&lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_chip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output_chip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timespec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSPERIOD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timespec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tv_nsec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;atoll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* open /dev/gpiochip0 */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;output_chip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_chip_open_by_number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;cm&quot;&gt;/* work on pin 3 */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;output_line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_chip_get_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output_chip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* config as output and set a description */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;gpiod_line_request_output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;blink&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                  &lt;span class=&quot;n&quot;&gt;GPIOD_LINE_ACTIVE_STATE_HIGH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;line_value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;gpiod_line_set_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;nanosleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;If the C program is written to ~/src/teaching/labs/lab2/blink.c, it can be 
compiled using:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;phwl@bream:~/elec3607/labs/lab2&lt;span class=&quot;nv&quot;&gt;$ H&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;~/src/teaching/
phwl@bream:~/elec3607/labs/lab2&lt;span class=&quot;nv&quot;&gt;$ $H&lt;/span&gt;/buildroot/output/host/bin/aarch64-buildroot-linux-uclibc-gcc &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; blink blink.c &lt;span class=&quot;nt&quot;&gt;-lgpiod&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In QEMU you can copy the file from the host to the guest and execute:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# scp phwl@10.0.2.2:src/teaching/labs/lab2/gpio .&lt;/span&gt;
phwl@10.0.2.2&lt;span class=&quot;s1&quot;&gt;'s password: 
# ./gpio
#
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;22-displaying-gpio_data&quot;&gt;2.2 Displaying GPIO_DATA&lt;/h3&gt;
&lt;p&gt;Nothing appears to happen as there is no output in QEMU. Normally in
an embedded system (as the name of the program suggests), we would 
have the GPIO line connected to an LED, which would blink according
to the program.&lt;/p&gt;

&lt;p&gt;The GPIO peripheral used in the
qemu_aarch64_virt machine is described in the 
 &lt;a href=&quot;https://developer.arm.com/documentation/ddi0190/b&quot;&gt;ARM PrimeCell General Purpose Input/Output (PL061) Technical Reference Manual&lt;/a&gt; (which we will call the datasheet).  During boot up, the message&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pl061_gpio 9030000.pl061: PL061 GPIO chip registered
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or using
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;info mtree&lt;/code&gt; in the QEMU monitor, you get&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0000000009030000-0000000009030fff (prio 0, i/o): pl061
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;shows that the start address (GPIOBASE in the datasheet) is 0x9030000.
The address of GPIODATA is 0x9030000-0x9030ff and GPIODIR is 0x9030400.&lt;/p&gt;

&lt;p&gt;We can use the following program to interrogate the state of the GPIODATA
register in the PL061 and print its value when it changes.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cm&quot;&gt;/*
**    pl061-change.c     - display changes to the GPIO_GPIODATA state
*/&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;sys/mman.h&amp;gt;
#include &amp;lt;sys/types.h&amp;gt;
#include &amp;lt;sys/stat.h&amp;gt;
#include &amp;lt;fcntl.h&amp;gt;
#include &amp;lt;time.h&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define GPIO0_START_ADDR 0x09030000
#define GPIO0_END_ADDR   0x09030fff
#define GPIO0_SIZE (GPIO0_END_ADDR - GPIO0_START_ADDR)
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#define GPIO_GPIODATA    0
&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/* high resolution time stamp */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;double&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;gethrtime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int64_t&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;ts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timespec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* read the time stamp */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clock_gettime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CLOCK_MONOTONIC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int64_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tv_sec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int64_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000000000&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int64_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tv_nsec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0e9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gpio_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gpio_gpiodata_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oldc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/dev/mem&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;O_RDWR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;gpio_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GPIO0_SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PROT_READ&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PROT_WRITE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
            &lt;span class=&quot;n&quot;&gt;MAP_SHARED&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GPIO0_START_ADDR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;gpio_gpiodata_addr&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpio_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GPIO_GPIODATA&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    
    &lt;span class=&quot;n&quot;&gt;oldc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gpio_gpiodata_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(;;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gpio_gpiodata_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;oldc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;oldc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;GPIODATA=%x (t=%fs)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gethrtime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;After copying it to the guest, it can be used to verify blink as follows:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ./pl061-change &amp;amp;&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ./blink &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GPIODATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;46.833710s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GPIODATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;47.033845s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GPIODATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;47.233977s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GPIODATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;47.434119s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GPIODATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;47.634252s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GPIODATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;47.834385s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GPIODATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;48.034518s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GPIODATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;48.234652s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GPIODATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;48.434785s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;GPIODATA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;48.634919s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The time on the output shows that the period of the GPIO output change
is roughly 0.2s which is close to the value of NSPERIOD (the desired delay
in nanoseconds) specified in blink.c.&lt;/p&gt;

&lt;h2 id=&quot;3-libgpiod-application-programmers-interface-programming&quot;&gt;3. libgpiod Application Programmers’ Interface Programming&lt;/h2&gt;
&lt;p&gt;Is it possible to display the state of the GPIO while simultaneously
writing to it? The first shell command sets gpiochip0 line 1,
and stays in the background (the -b option) for 10 seconds (-mtime -s10)
before ending. You can’t read the line with gpioget until the gpioset
program ends.&lt;/p&gt;

&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# gpioset -b -mtime -s10 gpiochip0 1=1&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# gpioget gpiochip0 1&lt;/span&gt;
gpioget: error reading GPIO values: Device or resource busy
&lt;span class=&quot;c&quot;&gt;# &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Normally, we use the GPIO pins to control something and don’t need
to read what we wrote. But is it possible to do so in QEMU?  The
solution turned out more complicated than I would have liked.&lt;/p&gt;

&lt;p&gt;The first thing is that we want to do the read and write in parallel,
not as two separate processes. There are many ways to do this but
multithreading (using &lt;a href=&quot;https://computing.llnl.gov/tutorials/pthreads/&quot;&gt;POSIX threads&lt;/a&gt;) is one solution. The second problem is that the writer must release the
line so that the reader can access it or you get the same “Device or
resource busy” error.&lt;/p&gt;

&lt;p&gt;The code below implements these ideas.  The gpio_reader() function
checks when a pin changes and prints the new state. This
gpiod_line_event_wait() function will return with a value &amp;gt; 0 if
an event has occurred and we print the pin state and time. Otherwise,
it either encountered an error or timed out.  The gpio_writer()
function toggles the output after a fixed delay, specified in the
delay structure. A mutual exclusion (via the mutexline variable)
is used to ensure that only the reader or writer has access to the
line at any time. This restricts the line to either be an output
(via gpiod_line_request_output()) or an event (via
gpiod_line_request_both_edges_events()) at any time, not both.&lt;/p&gt;

&lt;p&gt;These two threads run in parallel and when they get the line, will
perform their task, after which they sleep (via nanosleep()). The gpio_reader()
function executes about 100x faster than the writer.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cm&quot;&gt;/*
**    Blinky under QEMU and libgpiod
*/&lt;/span&gt;

&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;pthread.h&amp;gt;
#include &amp;lt;assert.h&amp;gt;
#include &amp;lt;gpiod.h&amp;gt;
#include &amp;lt;time.h&amp;gt;
&lt;/span&gt; 
&lt;span class=&quot;cp&quot;&gt;#define CONSUMER &quot;gpiod-lab&quot;        &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;/* this identifies the consumer */&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#define NUM_THREADS 2               &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;/* we have one writer and one reader */&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
#define NSPERIOD    200000000ULL    &lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;/* output period in ns */&lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;
&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pthread_mutex_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mutexline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;          &lt;span class=&quot;cm&quot;&gt;/* only reader or writer can access line */&lt;/span&gt;
 
&lt;span class=&quot;cm&quot;&gt;/* create thread argument struct for thr_func() */&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_thread_data_t&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gpioline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread_data_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 
&lt;span class=&quot;cm&quot;&gt;/* high resolution time stamp */&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;double&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;gethrtime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int64_t&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;ts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timespec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* read the time stamp */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clock_gettime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CLOCK_MONOTONIC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int64_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tv_sec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int64_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000000000&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int64_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tv_nsec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0e9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/*
**    Display edges 
*/&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;gpio_reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timespec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSPERIOD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100ULL&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timespec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shortdelay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSPERIOD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100ULL&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timespec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(;;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;cm&quot;&gt;/* get exclusive access to the line */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pthread_mutex_lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mutexline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* get line */&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_line_request_both_edges_events&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CONSUMER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;release&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* wait for an event */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_line_event_wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;    &lt;span class=&quot;cm&quot;&gt;/* success */&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;cm&quot;&gt;/* read the gpio pin value */&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_line_get_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Event %d: Pin=%d at t=%fs&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gethrtime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* release the line */&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;release:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;gpiod_line_release&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pthread_mutex_unlock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mutexline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;nanosleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shortdelay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/*
**    Blink a number of times
*/&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;gpio_writer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timespec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NSPERIOD&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timespec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;cm&quot;&gt;/* get exclusive access to the line */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pthread_mutex_lock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mutexline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;cm&quot;&gt;/* config as output and set a description */&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_line_request_output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CONSUMER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;goto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;release&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* toggle output */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;gpiod_line_set_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* release line */&lt;/span&gt;
    &lt;span class=&quot;nl&quot;&gt;release:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;gpiod_line_release&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;pthread_mutex_unlock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mutexline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;nanosleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/* 
**    Create pthreads - the thread created will either be a reader or writer 
*/&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;thr_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;thread_data_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thread_data_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;arg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 
    &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* writer */&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;gpio_writer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gpioline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;nl&quot;&gt;default:&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* reader */&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;gpio_reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gpioline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
 
    &lt;span class=&quot;n&quot;&gt;pthread_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
 
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; 
&lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pthread_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NUM_THREADS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pthread_attr_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;attr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* create a thread_data_t argument array */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;thread_data_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thr_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NUM_THREADS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* gpio structures */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_chip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output_chip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* open /dev/gpiochip0 */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;output_chip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_chip_open_by_number&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;cm&quot;&gt;/* work on pin 3 */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;output_line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gpiod_chip_get_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output_chip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* create threads */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pthread_mutex_init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mutexline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NUM_THREADS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;thr_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;thr_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gpioline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;output_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pthread_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thr_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thr_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* block until thread 0 completes */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pthread_join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fflush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stdout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
 
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;If the C program is written to ~/src/teaching/labs/lab2/gpio.c, it can be 
compiled using:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;phwl@bream:~/elec3607/labs/lab2&lt;span class=&quot;nv&quot;&gt;$ H&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;~/src/teaching/
phwl@bream:~/elec3607/labs/lab2&lt;span class=&quot;nv&quot;&gt;$ $H&lt;/span&gt;/buildroot/output/host/bin/aarch64-buildroot-linux-uclibc-gcc &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; gpio gpio.c &lt;span class=&quot;nt&quot;&gt;-lgpiod&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-lpthread&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When executed under QEMU (it needs to first be transferred to the guest via ssh), you will see:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# scp phwl@10.0.2.2:src/teaching/labs/lab2/gpio .&lt;/span&gt;
phwl@10.0.2.2&lt;span class=&quot;s1&quot;&gt;'s password: 
# ./gpio
Event 1: Pin=1 at t=19925.878483s
Event 2: Pin=0 at t=19925.978926s
Event 3: Pin=1 at t=19926.077777s
Event 4: Pin=0 at t=19926.179461s
Event 5: Pin=1 at t=19926.277994s
Event 6: Pin=0 at t=19926.381006s
Event 7: Pin=1 at t=19926.479734s
Event 8: Pin=0 at t=19926.582780s
Event 9: Pin=1 at t=19926.681464s
Event 10: Pin=0 at t=19926.784994s
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>phwl</name></author><category term="academia" /><category term="embedded" /><summary type="html">This post details how to use the GPIO peripheral on the ARM linux image built in Creating an emulated ARM Linux system using Buildroot and QEMU</summary></entry><entry><title type="html">Creating an emulated ARM Linux system using Buildroot and QEMU</title><link href="http://localhost:4000/2021/emulated-ARM-Linux-with-Buildroot-and-QEMU/" rel="alternate" type="text/html" title="Creating an emulated ARM Linux system using Buildroot and QEMU" /><published>2021-01-07T17:02:24+11:00</published><updated>2021-01-07T17:02:24+11:00</updated><id>http://localhost:4000/2021/emulated-ARM-Linux-with-Buildroot-and-QEMU</id><content type="html" xml:base="http://localhost:4000/2021/emulated-ARM-Linux-with-Buildroot-and-QEMU/">&lt;p&gt;This post details how to build an ARM linux image via &lt;a href=&quot;https://buildroot.org&quot;&gt;buildroot&lt;/a&gt;, and emulate it using &lt;a href=&quot;https://www.qemu.org/&quot;&gt;QEMU&lt;/a&gt;. This was done using an Ubuntu 18.04.5 LTS host machine.&lt;/p&gt;

&lt;h2 id=&quot;1-buildroot&quot;&gt;1. Buildroot&lt;/h2&gt;

&lt;p&gt;An ARM 64-bit embedded Linux system requires a file system, kernel
image and user applications. Moreover, a cross compiler is needed
to build one from scratch, and an emulator (like
&lt;a href=&quot;https://www.qemu.org/&quot;&gt;QEMU&lt;/a&gt;) is required if it will be tested on
a non-ARM platform. &lt;a href=&quot;https://buildroot.org/&quot;&gt;Buildroot&lt;/a&gt; automates
this process. It can do a lot more than what is described here
and you should refer to its
&lt;a href=&quot;https://buildroot.org/docs.html&quot;&gt;extensive documentation and training materials&lt;/a&gt;
for details.&lt;/p&gt;

&lt;p&gt;Download buildroot, generate an initial &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.config&lt;/code&gt; file
and start &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;menuconfig&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;phwl@bream:~&lt;span class=&quot;nv&quot;&gt;$ H&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;~/elec3607/
phwl@bream:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$H&lt;/span&gt;
phwl@bream:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$H&lt;/span&gt;
phwl@bream:~/elec3607&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git clone git://git.buildroot.net/buildroot
Cloning into &lt;span class=&quot;s1&quot;&gt;'buildroot'&lt;/span&gt;...
remote: Enumerating objects: 24805, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
remote: Counting objects: 100% &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;24805/24805&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
remote: Compressing objects: 100% &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;11902/11902&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
remote: Total 401699 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;delta 15432&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, reused 20763 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;delta 12840&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, pack-reused 376894
Receiving objects: 100% &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;401699/401699&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, 87.06 MiB | 5.76 MiB/s, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Resolving deltas: 100% &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;279114/279114&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
phwl@bream:~/elec3607&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;buildroot/
phwl@bream:~/elec3607/buildroot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make qemu_aarch64_virt_defconfig
&lt;span class=&quot;nb&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; /home/phwl/elec3607/buildroot/output/build/buildroot-config/lxdialog
&lt;span class=&quot;nv&quot;&gt;PKG_CONFIG_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt; make &lt;span class=&quot;nv&quot;&gt;CC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/bin/gcc&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;HOSTCC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/usr/bin/gcc&quot;&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/home/phwl/elec3607/buildroot/output/build/buildroot-config &lt;span class=&quot;nt&quot;&gt;-C&lt;/span&gt; support/kconfig &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; Makefile.br conf
/usr/bin/gcc &lt;span class=&quot;nt&quot;&gt;-D_GNU_SOURCE&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-D_DEFAULT_SOURCE&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-DCURSES_LOC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;ncurses.h&amp;gt;&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-DLOCALE&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt;/home/phwl/elec3607/buildroot/output/build/buildroot-config &lt;span class=&quot;nt&quot;&gt;-DCONFIG_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;\&quot;&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-MM&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.c &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; /home/phwl/elec3607/buildroot/output/build/buildroot-config/.depend 2&amp;gt;/dev/null &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; :
/usr/bin/gcc &lt;span class=&quot;nt&quot;&gt;-D_GNU_SOURCE&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-D_DEFAULT_SOURCE&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-DCURSES_LOC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;ncurses.h&amp;gt;&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-DLOCALE&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt;/home/phwl/elec3607/buildroot/output/build/buildroot-config &lt;span class=&quot;nt&quot;&gt;-DCONFIG_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;\&quot;&lt;/span&gt;   &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; conf.c &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; /home/phwl/elec3607/buildroot/output/build/buildroot-config/conf.o
/usr/bin/gcc &lt;span class=&quot;nt&quot;&gt;-D_GNU_SOURCE&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-D_DEFAULT_SOURCE&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-DCURSES_LOC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;ncurses.h&amp;gt;&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-DLOCALE&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt;/home/phwl/elec3607/buildroot/output/build/buildroot-config &lt;span class=&quot;nt&quot;&gt;-DCONFIG_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;\&quot;&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /home/phwl/elec3607/buildroot/output/build/buildroot-config/zconf.tab.c &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; /home/phwl/elec3607/buildroot/output/build/buildroot-config/zconf.tab.o
/usr/bin/gcc &lt;span class=&quot;nt&quot;&gt;-D_GNU_SOURCE&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-D_DEFAULT_SOURCE&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-DCURSES_LOC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;ncurses.h&amp;gt;&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-DLOCALE&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt;/home/phwl/elec3607/buildroot/output/build/buildroot-config &lt;span class=&quot;nt&quot;&gt;-DCONFIG_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;\&quot;&lt;/span&gt;   /home/phwl/elec3607/buildroot/output/build/buildroot-config/conf.o /home/phwl/elec3607/buildroot/output/build/buildroot-config/zconf.tab.o  &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; /home/phwl/elec3607/buildroot/output/build/buildroot-config/conf
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; /home/phwl/elec3607/buildroot/output/build/buildroot-config/zconf.tab.c
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# configuration written to /home/phwl/elec3607/buildroot/.config&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;
phwl@bream:~/elec3607/buildroot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make menuconfig
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Under &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;menuconfig&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; 1. Select Kernel &amp;gt; Linux Kernel Tools &amp;gt; gpio
 1. Select Target Packages &amp;gt; Libraries &amp;gt; Hardware Handling &amp;gt; libgiod 
 1. Select Target Packages &amp;gt; Libraries &amp;gt; Hardware Handling &amp;gt; libgiod install tools
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then save and type&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;make linux-menuconfig
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a while you will see the Linux kernel configuration menu.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; 1. Select Device Drivers &amp;gt; GPIO Support &amp;gt; Memory mapped GPIO drivers &amp;gt; PrimeCell PL061 GPIO support
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Build the image with&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;time &lt;/span&gt;make
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a while (15 minutes on my desktop machine), it should finish and then run QEMU using:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;output/images
./start-qemu.sh 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You should see the following output:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;phwl@bream:~/elec3607/buildroot/output/images&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./start-qemu.sh 
Booting Linux on physical CPU 0x0000000000 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;0x410fd034]
Linux version 5.4.58 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;phwl@bream&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;gcc version 9.3.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Buildroot 2020.11-607-gb4db6905a4&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#1 SMP Fri Jan 8 20:11:45 AEDT 2021&lt;/span&gt;
Machine model: linux,dummy-virt
efi: Getting EFI parameters from FDT:
efi: UEFI not found.
psci: probing &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;conduit method from DT.
psci: PSCIv0.2 detected &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;firmware.
psci: Using standard PSCI v0.2 &lt;span class=&quot;k&quot;&gt;function &lt;/span&gt;IDs
psci: Trusted OS migration not required
percpu: Embedded 21 pages/cpu s46936 r8192 d30888 u86016
Detected VIPT I-cache on CPU0
CPU features: detected: ARM erratum 845719
CPU features: detected: ARM erratum 843419
Built 1 zonelists, mobility grouping on.  Total pages: 32256
Kernel &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;line: rootwait &lt;span class=&quot;nv&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/vda &lt;span class=&quot;nv&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ttyAMA0
Dentry cache &lt;span class=&quot;nb&quot;&gt;hash &lt;/span&gt;table entries: 16384 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;order: 5, 131072 bytes, linear&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Inode-cache &lt;span class=&quot;nb&quot;&gt;hash &lt;/span&gt;table entries: 8192 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;order: 4, 65536 bytes, linear&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
mem auto-init: stack:off, heap alloc:off, heap free:off
Memory: 104460K/131072K available &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;6012K kernel code, 340K rwdata, 1416K rodata, 448K init, 326K bss, 26612K reserved, 0K cma-reserved&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
SLUB: &lt;span class=&quot;nv&quot;&gt;HWalign&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;64, &lt;span class=&quot;nv&quot;&gt;Order&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0-3, &lt;span class=&quot;nv&quot;&gt;MinObjects&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0, &lt;span class=&quot;nv&quot;&gt;CPUs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1, &lt;span class=&quot;nv&quot;&gt;Nodes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
rcu: Hierarchical RCU implementation.
rcu: 	RCU restricting CPUs from &lt;span class=&quot;nv&quot;&gt;NR_CPUS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;256 to &lt;span class=&quot;nv&quot;&gt;nr_cpu_ids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1.
rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.
rcu: Adjusting geometry &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;rcu_fanout_leaf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;16, &lt;span class=&quot;nv&quot;&gt;nr_cpu_ids&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
NR_IRQS: 64, nr_irqs: 64, preallocated irqs: 0
GICv2m: range[mem 0x08020000-0x08020fff], SPI[80:143]
random: get_random_bytes called from start_kernel+0x2a8/0x420 with &lt;span class=&quot;nv&quot;&gt;crng_init&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
arch_timer: cp15 timer&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; running at 62.50MHz &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;virt&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
clocksource: arch_sys_counter: mask: 0xffffffffffffff max_cycles: 0x1cd42e208c, max_idle_ns: 881590405314 ns
sched_clock: 56 bits at 62MHz, resolution 16ns, wraps every 4398046511096ns
Console: colour dummy device 80x25
Calibrating delay loop &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;skipped&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, value calculated using timer frequency.. 125.00 BogoMIPS &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lpj&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;250000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
pid_max: default: 32768 minimum: 301
Mount-cache &lt;span class=&quot;nb&quot;&gt;hash &lt;/span&gt;table entries: 512 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;order: 0, 4096 bytes, linear&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Mountpoint-cache &lt;span class=&quot;nb&quot;&gt;hash &lt;/span&gt;table entries: 512 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;order: 0, 4096 bytes, linear&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
ASID allocator initialised with 32768 entries
rcu: Hierarchical SRCU implementation.
EFI services will not be available.
smp: Bringing up secondary CPUs ...
smp: Brought up 1 node, 1 CPU
SMP: Total of 1 processors activated.
CPU features: detected: 32-bit EL0 Support
CPU features: detected: CRC32 instructions
CPU: All CPU&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; started at EL1
alternatives: patching kernel code
devtmpfs: initialized
clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns
futex &lt;span class=&quot;nb&quot;&gt;hash &lt;/span&gt;table entries: 256 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;order: 2, 16384 bytes, linear&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
DMI not present or invalid.
NET: Registered protocol family 16
DMA: preallocated 256 KiB pool &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;atomic allocations
hw-breakpoint: found 6 breakpoint and 4 watchpoint registers.
Serial: AMBA PL011 UART driver
9000000.pl011: ttyAMA0 at MMIO 0x9000000 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;irq &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 39, base_baud &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is a PL011 rev1
printk: console &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;ttyAMA0] enabled
iommu: Default domain &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;: Translated 
vgaarb: loaded
SCSI subsystem initialized
clocksource: Switched to clocksource arch_sys_counter
NET: Registered protocol family 2
tcp_listen_portaddr_hash &lt;span class=&quot;nb&quot;&gt;hash &lt;/span&gt;table entries: 256 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;order: 0, 4096 bytes, linear&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
TCP established &lt;span class=&quot;nb&quot;&gt;hash &lt;/span&gt;table entries: 1024 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;order: 1, 8192 bytes, linear&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
TCP &lt;span class=&quot;nb&quot;&gt;bind hash &lt;/span&gt;table entries: 1024 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;order: 2, 16384 bytes, linear&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
TCP: Hash tables configured &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;established 1024 &lt;span class=&quot;nb&quot;&gt;bind &lt;/span&gt;1024&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
UDP &lt;span class=&quot;nb&quot;&gt;hash &lt;/span&gt;table entries: 256 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;order: 1, 8192 bytes, linear&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
UDP-Lite &lt;span class=&quot;nb&quot;&gt;hash &lt;/span&gt;table entries: 256 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;order: 1, 8192 bytes, linear&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
NET: Registered protocol family 1
PCI: CLS 0 bytes, default 64
hw perfevents: enabled with armv8_pmuv3 PMU driver, 5 counters available
workingset: &lt;span class=&quot;nv&quot;&gt;timestamp_bits&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;62 &lt;span class=&quot;nv&quot;&gt;max_order&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;15 &lt;span class=&quot;nv&quot;&gt;bucket_order&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
fuse: init &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;API version 7.31&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Block layer SCSI generic &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bsg&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; driver version 0.4 loaded &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;major 251&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
io scheduler mq-deadline registered
io scheduler kyber registered
pl061_gpio 9030000.pl061: PL061 GPIO chip registered
pci-host-generic 4010000000.pcie: host bridge /pcie@10000000 ranges:
pci-host-generic 4010000000.pcie:    IO 0x3eff0000..0x3effffff -&amp;gt; 0x00000000
pci-host-generic 4010000000.pcie:   MEM 0x10000000..0x3efeffff -&amp;gt; 0x10000000
pci-host-generic 4010000000.pcie:   MEM 0x8000000000..0xffffffffff -&amp;gt; 0x8000000000
pci-host-generic 4010000000.pcie: ECAM at &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mem 0x4010000000-0x401fffffff] &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;bus 00-ff]
pci-host-generic 4010000000.pcie: PCI host bridge to bus 0000:00
pci_bus 0000:00: root bus resource &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;bus 00-ff]
pci_bus 0000:00: root bus resource &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;io  0x0000-0xffff]
pci_bus 0000:00: root bus resource &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mem 0x10000000-0x3efeffff]
pci_bus 0000:00: root bus resource &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;mem 0x8000000000-0xffffffffff]
pci 0000:00:00.0: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1b36:0008] &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;00 class 0x060000
cacheinfo: Unable to detect cache hierarchy &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;CPU 0
virtio_blk virtio0: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vda] 122880 512-byte logical blocks &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;62.9 MB/60.0 MiB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
rtc-pl031 9010000.pl031: registered as rtc0
NET: Registered protocol family 10
Segment Routing with IPv6
sit: IPv6, IPv4 and MPLS over IPv4 tunneling driver
NET: Registered protocol family 17
NET: Registered protocol family 15
registered taskstats version 1
rtc-pl031 9010000.pl031: setting system clock to 2021-01-08T09:12:58 UTC &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1610097178&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
EXT4-fs &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;vda&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: mounted filesystem with ordered data mode. Opts: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;null&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
VFS: Mounted root &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ext4 filesystem&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;readonly &lt;/span&gt;on device 254:0.
devtmpfs: mounted
Freeing unused kernel memory: 448K
Run /sbin/init as init process
EXT4-fs &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;vda&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: re-mounted. Opts: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;null&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
ext4 filesystem being remounted at / supports timestamps &lt;span class=&quot;k&quot;&gt;until &lt;/span&gt;2038 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0x7fffffff&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Starting syslogd: OK
Starting klogd: OK
Running sysctl: OK
Saving random seed: random: &lt;span class=&quot;nb&quot;&gt;dd&lt;/span&gt;: uninitialized urandom &lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;512 bytes &lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
OK
Starting network: udhcpc: started, v1.32.0
random: &lt;span class=&quot;nb&quot;&gt;mktemp&lt;/span&gt;: uninitialized urandom &lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;6 bytes &lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
udhcpc: sending discover
udhcpc: sending &lt;span class=&quot;k&quot;&gt;select for &lt;/span&gt;10.0.2.15
udhcpc: lease of 10.0.2.15 obtained, lease &lt;span class=&quot;nb&quot;&gt;time &lt;/span&gt;86400
deleting routers
random: &lt;span class=&quot;nb&quot;&gt;mktemp&lt;/span&gt;: uninitialized urandom &lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;6 bytes &lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
adding dns 10.0.2.3
OK

Welcome to Buildroot
buildroot login: IPv6: ADDRCONF&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;NETDEV_CHANGE&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: eth0: &lt;span class=&quot;nb&quot;&gt;link &lt;/span&gt;becomes ready
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Enter “root” as the user name and no password is required. You can
exit QEMU with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl-a x&lt;/code&gt; and get help with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl-a h&lt;/code&gt;.
The monitor is invoked with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl-a c&lt;/code&gt;, and can provide information
about the underlying hardware, e.g. the memory tree:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(qemu) info mtree
address-space: memory
  0000000000000000-ffffffffffffffff (prio 0, i/o): system
    0000000000000000-0000000003ffffff (prio 0, romd): virt.flash0
    0000000004000000-0000000007ffffff (prio 0, romd): virt.flash1
    0000000008000000-0000000008000fff (prio 0, i/o): gic_dist
    0000000008010000-0000000008011fff (prio 0, i/o): gic_cpu
    0000000008020000-0000000008020fff (prio 0, i/o): gicv2m
    0000000009000000-0000000009000fff (prio 0, i/o): pl011
    0000000009010000-0000000009010fff (prio 0, i/o): pl031
    0000000009020000-0000000009020007 (prio 0, i/o): fwcfg.data
    0000000009020008-0000000009020009 (prio 0, i/o): fwcfg.ctl
    0000000009020010-0000000009020017 (prio 0, i/o): fwcfg.dma
    0000000009030000-0000000009030fff (prio 0, i/o): pl061
    000000000a000000-000000000a0001ff (prio 0, i/o): virtio-mmio
    000000000a000200-000000000a0003ff (prio 0, i/o): virtio-mmio
    000000000a000400-000000000a0005ff (prio 0, i/o): virtio-mmio
    000000000a000600-000000000a0007ff (prio 0, i/o): virtio-mmio
    000000000a000800-000000000a0009ff (prio 0, i/o): virtio-mmio
    000000000a000a00-000000000a000bff (prio 0, i/o): virtio-mmio
    000000000a000c00-000000000a000dff (prio 0, i/o): virtio-mmio
    000000000a000e00-000000000a000fff (prio 0, i/o): virtio-mmio
    000000000a001000-000000000a0011ff (prio 0, i/o): virtio-mmio
    000000000a001200-000000000a0013ff (prio 0, i/o): virtio-mmio
    000000000a001400-000000000a0015ff (prio 0, i/o): virtio-mmio
    000000000a001600-000000000a0017ff (prio 0, i/o): virtio-mmio
    000000000a001800-000000000a0019ff (prio 0, i/o): virtio-mmio
    000000000a001a00-000000000a001bff (prio 0, i/o): virtio-mmio
    000000000a001c00-000000000a001dff (prio 0, i/o): virtio-mmio
    000000000a001e00-000000000a001fff (prio 0, i/o): virtio-mmio
    000000000a002000-000000000a0021ff (prio 0, i/o): virtio-mmio
    000000000a002200-000000000a0023ff (prio 0, i/o): virtio-mmio
    000000000a002400-000000000a0025ff (prio 0, i/o): virtio-mmio
    000000000a002600-000000000a0027ff (prio 0, i/o): virtio-mmio
    000000000a002800-000000000a0029ff (prio 0, i/o): virtio-mmio
    000000000a002a00-000000000a002bff (prio 0, i/o): virtio-mmio
    000000000a002c00-000000000a002dff (prio 0, i/o): virtio-mmio
    000000000a002e00-000000000a002fff (prio 0, i/o): virtio-mmio
    000000000a003000-000000000a0031ff (prio 0, i/o): virtio-mmio
    000000000a003200-000000000a0033ff (prio 0, i/o): virtio-mmio
    000000000a003400-000000000a0035ff (prio 0, i/o): virtio-mmio
    000000000a003600-000000000a0037ff (prio 0, i/o): virtio-mmio
    000000000a003800-000000000a0039ff (prio 0, i/o): virtio-mmio
    000000000a003a00-000000000a003bff (prio 0, i/o): virtio-mmio
    000000000a003c00-000000000a003dff (prio 0, i/o): virtio-mmio
    000000000a003e00-000000000a003fff (prio 0, i/o): virtio-mmio
    000000000c000000-000000000dffffff (prio 0, i/o): platform bus
    0000000010000000-000000003efeffff (prio 0, i/o): alias pcie-mmio @gpex_mmio 0000000010000000-000000003efeffff
    000000003eff0000-000000003effffff (prio 0, i/o): gpex_ioport
    0000000040000000-0000000047ffffff (prio 0, ram): mach-virt.ram
    0000004010000000-000000401fffffff (prio 0, i/o): alias pcie-ecam @pcie-mmcfg-mmio 0000000000000000-000000000fffffff
    0000008000000000-000000ffffffffff (prio 0, i/o): alias pcie-mmio-high @gpex_mmio 0000008000000000-000000ffffffffff

address-space: I/O
  0000000000000000-000000000000ffff (prio 0, i/o): io

address-space: cpu-memory-0
  0000000000000000-ffffffffffffffff (prio 0, i/o): system
    0000000000000000-0000000003ffffff (prio 0, romd): virt.flash0
    0000000004000000-0000000007ffffff (prio 0, romd): virt.flash1
    0000000008000000-0000000008000fff (prio 0, i/o): gic_dist
    0000000008010000-0000000008011fff (prio 0, i/o): gic_cpu
    0000000008020000-0000000008020fff (prio 0, i/o): gicv2m
    0000000009000000-0000000009000fff (prio 0, i/o): pl011
    0000000009010000-0000000009010fff (prio 0, i/o): pl031
    0000000009020000-0000000009020007 (prio 0, i/o): fwcfg.data
    0000000009020008-0000000009020009 (prio 0, i/o): fwcfg.ctl
    0000000009020010-0000000009020017 (prio 0, i/o): fwcfg.dma
    0000000009030000-0000000009030fff (prio 0, i/o): pl061
    000000000a000000-000000000a0001ff (prio 0, i/o): virtio-mmio
    000000000a000200-000000000a0003ff (prio 0, i/o): virtio-mmio
    000000000a000400-000000000a0005ff (prio 0, i/o): virtio-mmio
    000000000a000600-000000000a0007ff (prio 0, i/o): virtio-mmio
    000000000a000800-000000000a0009ff (prio 0, i/o): virtio-mmio
    000000000a000a00-000000000a000bff (prio 0, i/o): virtio-mmio
    000000000a000c00-000000000a000dff (prio 0, i/o): virtio-mmio
    000000000a000e00-000000000a000fff (prio 0, i/o): virtio-mmio
    000000000a001000-000000000a0011ff (prio 0, i/o): virtio-mmio
    000000000a001200-000000000a0013ff (prio 0, i/o): virtio-mmio
    000000000a001400-000000000a0015ff (prio 0, i/o): virtio-mmio
    000000000a001600-000000000a0017ff (prio 0, i/o): virtio-mmio
    000000000a001800-000000000a0019ff (prio 0, i/o): virtio-mmio
    000000000a001a00-000000000a001bff (prio 0, i/o): virtio-mmio
    000000000a001c00-000000000a001dff (prio 0, i/o): virtio-mmio
    000000000a001e00-000000000a001fff (prio 0, i/o): virtio-mmio
    000000000a002000-000000000a0021ff (prio 0, i/o): virtio-mmio
    000000000a002200-000000000a0023ff (prio 0, i/o): virtio-mmio
    000000000a002400-000000000a0025ff (prio 0, i/o): virtio-mmio
    000000000a002600-000000000a0027ff (prio 0, i/o): virtio-mmio
    000000000a002800-000000000a0029ff (prio 0, i/o): virtio-mmio
    000000000a002a00-000000000a002bff (prio 0, i/o): virtio-mmio
    000000000a002c00-000000000a002dff (prio 0, i/o): virtio-mmio
    000000000a002e00-000000000a002fff (prio 0, i/o): virtio-mmio
    000000000a003000-000000000a0031ff (prio 0, i/o): virtio-mmio
    000000000a003200-000000000a0033ff (prio 0, i/o): virtio-mmio
    000000000a003400-000000000a0035ff (prio 0, i/o): virtio-mmio
    000000000a003600-000000000a0037ff (prio 0, i/o): virtio-mmio
    000000000a003800-000000000a0039ff (prio 0, i/o): virtio-mmio
    000000000a003a00-000000000a003bff (prio 0, i/o): virtio-mmio
    000000000a003c00-000000000a003dff (prio 0, i/o): virtio-mmio
    000000000a003e00-000000000a003fff (prio 0, i/o): virtio-mmio
    000000000c000000-000000000dffffff (prio 0, i/o): platform bus
    0000000010000000-000000003efeffff (prio 0, i/o): alias pcie-mmio @gpex_mmio 0000000010000000-000000003efeffff
    000000003eff0000-000000003effffff (prio 0, i/o): gpex_ioport
    0000000040000000-0000000047ffffff (prio 0, ram): mach-virt.ram
    0000004010000000-000000401fffffff (prio 0, i/o): alias pcie-ecam @pcie-mmcfg-mmio 0000000000000000-000000000fffffff
    0000008000000000-000000ffffffffff (prio 0, i/o): alias pcie-mmio-high @gpex_mmio 0000008000000000-000000ffffffffff

address-space: gpex-root
  0000000000000000-ffffffffffffffff (prio 0, i/o): bus master container

memory-region: gpex_mmio
  0000000000000000-ffffffffffffffff (prio 0, i/o): gpex_mmio

memory-region: pcie-mmcfg-mmio
  0000000000000000-000000001fffffff (prio 0, i/o): pcie-mmcfg-mmio

memory-region: system
  0000000000000000-ffffffffffffffff (prio 0, i/o): system
    0000000000000000-0000000003ffffff (prio 0, romd): virt.flash0
    0000000004000000-0000000007ffffff (prio 0, romd): virt.flash1
    0000000008000000-0000000008000fff (prio 0, i/o): gic_dist
    0000000008010000-0000000008011fff (prio 0, i/o): gic_cpu
    0000000008020000-0000000008020fff (prio 0, i/o): gicv2m
    0000000009000000-0000000009000fff (prio 0, i/o): pl011
    0000000009010000-0000000009010fff (prio 0, i/o): pl031
    0000000009020000-0000000009020007 (prio 0, i/o): fwcfg.data
    0000000009020008-0000000009020009 (prio 0, i/o): fwcfg.ctl
    0000000009020010-0000000009020017 (prio 0, i/o): fwcfg.dma
    0000000009030000-0000000009030fff (prio 0, i/o): pl061
    000000000a000000-000000000a0001ff (prio 0, i/o): virtio-mmio
    000000000a000200-000000000a0003ff (prio 0, i/o): virtio-mmio
    000000000a000400-000000000a0005ff (prio 0, i/o): virtio-mmio
    000000000a000600-000000000a0007ff (prio 0, i/o): virtio-mmio
    000000000a000800-000000000a0009ff (prio 0, i/o): virtio-mmio
    000000000a000a00-000000000a000bff (prio 0, i/o): virtio-mmio
    000000000a000c00-000000000a000dff (prio 0, i/o): virtio-mmio
    000000000a000e00-000000000a000fff (prio 0, i/o): virtio-mmio
    000000000a001000-000000000a0011ff (prio 0, i/o): virtio-mmio
    000000000a001200-000000000a0013ff (prio 0, i/o): virtio-mmio
    000000000a001400-000000000a0015ff (prio 0, i/o): virtio-mmio
    000000000a001600-000000000a0017ff (prio 0, i/o): virtio-mmio
    000000000a001800-000000000a0019ff (prio 0, i/o): virtio-mmio
    000000000a001a00-000000000a001bff (prio 0, i/o): virtio-mmio
    000000000a001c00-000000000a001dff (prio 0, i/o): virtio-mmio
    000000000a001e00-000000000a001fff (prio 0, i/o): virtio-mmio
    000000000a002000-000000000a0021ff (prio 0, i/o): virtio-mmio
    000000000a002200-000000000a0023ff (prio 0, i/o): virtio-mmio
    000000000a002400-000000000a0025ff (prio 0, i/o): virtio-mmio
    000000000a002600-000000000a0027ff (prio 0, i/o): virtio-mmio
    000000000a002800-000000000a0029ff (prio 0, i/o): virtio-mmio
    000000000a002a00-000000000a002bff (prio 0, i/o): virtio-mmio
    000000000a002c00-000000000a002dff (prio 0, i/o): virtio-mmio
    000000000a002e00-000000000a002fff (prio 0, i/o): virtio-mmio
    000000000a003000-000000000a0031ff (prio 0, i/o): virtio-mmio
    000000000a003200-000000000a0033ff (prio 0, i/o): virtio-mmio
    000000000a003400-000000000a0035ff (prio 0, i/o): virtio-mmio
    000000000a003600-000000000a0037ff (prio 0, i/o): virtio-mmio
    000000000a003800-000000000a0039ff (prio 0, i/o): virtio-mmio
    000000000a003a00-000000000a003bff (prio 0, i/o): virtio-mmio
    000000000a003c00-000000000a003dff (prio 0, i/o): virtio-mmio
    000000000a003e00-000000000a003fff (prio 0, i/o): virtio-mmio
    000000000c000000-000000000dffffff (prio 0, i/o): platform bus
    0000000010000000-000000003efeffff (prio 0, i/o): alias pcie-mmio @gpex_mmio 0000000010000000-000000003efeffff
    000000003eff0000-000000003effffff (prio 0, i/o): gpex_ioport
    0000000040000000-0000000047ffffff (prio 0, ram): mach-virt.ram
    0000004010000000-000000401fffffff (prio 0, i/o): alias pcie-ecam @pcie-mmcfg-mmio 0000000000000000-000000000fffffff
    0000008000000000-000000ffffffffff (prio 0, i/o): alias pcie-mmio-high @gpex_mmio 0000008000000000-000000ffffffffff

(qemu) 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;./start-qemu.sh&lt;/code&gt; script is shown below. It emulates a Cortex-A53 which is an ARMv8-A 64-bit processor.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#!/bin/sh
(
BINARIES_DIR=&quot;${0%/*}/&quot;
cd ${BINARIES_DIR}

if [ &quot;${1}&quot; = &quot;serial-only&quot; ]; then
    EXTRA_ARGS='-nographic'
else
    EXTRA_ARGS=''
fi

export PATH=&quot;/home/phwl/src/teaching/buildroot/output/host/bin:${PATH}&quot;
exec qemu-system-aarch64 -M virt -cpu cortex-a53 -nographic -smp 1 -kernel Image
 -append &quot;rootwait root=/dev/vda console=ttyAMA0&quot; -netdev user,id=eth0 -device v
irtio-net-device,netdev=eth0 -drive file=rootfs.ext4,if=none,format=raw,id=hd0 -
device virtio-blk-device,drive=hd0  ${EXTRA_ARGS}
)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Refer to the &lt;a href=&quot;https://www.qemu.org/docs/master/&quot;&gt;QEMU documentation&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;2-installing-packages&quot;&gt;2. Installing packages&lt;/h2&gt;
&lt;p&gt;The usefulness of the Linux created is limited because very few packages were
installed in the previous step. In the buildroot home directory, type&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;make menuconfig
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;select&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Target packages &amp;gt; Networking applications &amp;gt; openssh&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;and then type&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;make 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This time the system will build much faster as only the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;openssh&lt;/code&gt;
package needs to be downloaded, compiled and placed in the system image.
Inside this new QEMU environment, you can&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh 10.0.2.2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to connect to the host.&lt;/p&gt;

&lt;h2 id=&quot;3-user-application-hello-qemu&quot;&gt;3. User Application: Hello QEMU&lt;/h2&gt;

&lt;p&gt;Create the following C program 
in some directory outside of the buildroot ones (I chose &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$H/labs/lab1&lt;/code&gt;
so the file is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$H/labs/lab1/hello.c&lt;/code&gt;).&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Hello QEMU&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;To compile it, we must remember to use a cross compiler as the target
is not the host machine but rather the guest ARM machine. Fortunately, can use the cross compiler that
buildroot created:&lt;/p&gt;
&lt;div class=&quot;language-sh highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$H&lt;/span&gt;/buildroot/output/host/bin/aarch64-linux-gcc &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; hello hello.c
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Start up the guest Linux with QEMU,copy the file from the host and execute&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;phwl@bream:~/elec3607/buildroot/output/images$ cd $H/buildroot/output/images
phwl@bream:~/elec3607/buildroot/output/images$ ./start-qemu.sh 
Booting Linux on physical CPU 0x0000000000 [0x410fd034]
...
Starting sshd: OK

Welcome to Buildroot
buildroot login: root
# scp phwl@10.0.2.2:src/teaching/labs/lab1/hello .
phwl@10.0.2.2's password: 
hello                                         100% 8680   852.3KB/s   00:00    
# ./hello
Hello QEMU
# 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>phwl</name></author><category term="academia" /><category term="embedded" /><summary type="html">This post details how to build an ARM linux image via buildroot, and emulate it using QEMU. This was done using an Ubuntu 18.04.5 LTS host machine.</summary></entry><entry><title type="html">Hawkesbury River 2020</title><link href="http://localhost:4000/2020/hawkesbury-2020/" rel="alternate" type="text/html" title="Hawkesbury River 2020" /><published>2020-12-21T20:54:38+11:00</published><updated>2020-12-21T20:54:38+11:00</updated><id>http://localhost:4000/2020/hawkesbury-2020</id><content type="html" xml:base="http://localhost:4000/2020/hawkesbury-2020/">&lt;p&gt;As has been the custom for many years, I went for a camping/fishing
trip with high-school friend Warren on the Hawkesbury River (here
is a list of &lt;a href=&quot;http://phwl.org/tags/#hawkesbury&quot;&gt;previous trips&lt;/a&gt;).&lt;/p&gt;

&lt;!-- more --&gt;
&lt;p&gt;The forecast was for rain so packed all the normal stuff plus
firewood. Although there is usually lots of boat traffic and 
people out fishing, this year was quiet because most people don’t want
to go out in the rain.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7341.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7341.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Just after the entrance to the expressway, I noticed that the bimini was
not right.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7344.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7344.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Turns out the rivets had failed.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7343.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7343.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;A quick field repair and we were on our way.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7346.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7346.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7347.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7347.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Seems like every year we bring more stuff …&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7350.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7350.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Due to bushfires, we could go last year. We came across an unexpected surprise. After years of camping here, we now need to book.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7352.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7352.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Fortunately, we could do it by mobile phone.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7354.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7354.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;First cast, a school jew which was released.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7355.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7355.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Next, a yellowfin bream (acanthopagrus australis). They are a very slow growing
fish. See the second last figure in &lt;a href=&quot;/assets/images/2020/12/Yellowfin-Bream.pdf&quot;&gt;this publication&lt;/a&gt; reproduced below, and the Ochwada paper cited within. 
Large ones should be released.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/breamgrowth.png&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/breamgrowth.png&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7357.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7357.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;We kept them alive in the live bait tank. After the session we decided to eat one and 
release the remaining two.
According to the table,
since the bottom one is about
24cm to the fork of the tail, it is about 5 years old. A
27cm bream would be 10 years old.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7360.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7360.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Sunset at camp.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7362.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7362.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Fish done in foil as is the usual custom.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7364.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7364.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7365.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7365.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Used the bream gut as bait for eel fishing. We cast it out and put bells on
the rod so we could fish while cooking. After two hours, it hadn’t been touched and I nearly gave up. 
Then, the bait was taken but no hookup. A few seconds after casting out
with a new bait, caught a nice pike eel.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7367.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7367.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;It looked like it was dead so I took my pliers and was going to unhook
the eel. In a flash, it swung its head around and bit me on the thumb.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7370.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7370.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;I was lucky to have a nice lip hook, it would have easily bit through my
6 kg monofilament trace. Anyway, I emerged as the victor!&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7375.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7375.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Came across removalists for Bar Point.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7387.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7387.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Hearty breakfast.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7397.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7397.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Monitor lizards are becoming less and less wary of people.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7430.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7430.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Splitting firewood.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7441.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7441.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Warren with a personal best pufferfish.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7457.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7457.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;To prepare steamed eel, you first cover it with salt and wash off the slime. Then
you cut it like below.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7389.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7389.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Black bean sauce.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7391.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7391.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Steamed.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7394.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7394.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Unfortunately, the eel tasted terrible! Will try barbecuing the next one.&lt;/p&gt;</content><author><name>phwl</name></author><category term="fishing" /><category term="hawkesbury" /><category term="australia" /><summary type="html">As has been the custom for many years, I went for a camping/fishing trip with high-school friend Warren on the Hawkesbury River (here is a list of previous trips).</summary></entry><entry><title type="html">Tasmanian Holiday</title><link href="http://localhost:4000/2020/tasmanian-holiday/" rel="alternate" type="text/html" title="Tasmanian Holiday" /><published>2020-12-18T20:29:04+11:00</published><updated>2020-12-18T20:29:04+11:00</updated><id>http://localhost:4000/2020/tasmanian-holiday</id><content type="html" xml:base="http://localhost:4000/2020/tasmanian-holiday/">&lt;p&gt;Went to Tasmania for a few days. Last time I was here was
&lt;a href=&quot;/2015/tasmanian-holiday-2015/&quot;&gt;2015&lt;/a&gt;.&lt;/p&gt;

&lt;!-- more --&gt;
&lt;p&gt;Sydney airport Terminal 2 wasn’t exactly busy.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7144.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7144.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7145.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7145.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Flew into Launceston and
hired a campervan from &lt;a href=&quot;https://www.hertz.com.au/p/hire-a-car/australia/tasmania/launceston/launceston-downtown&quot;&gt;Autorent Hertz&lt;/a&gt; in Launceston.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7159.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7159.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7168.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7168.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7171.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7171.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/DSCF6635.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/DSCF6635.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;We settled in the Caravan Park at Devonport and drove out to &lt;a href=&quot;https://www.hurseyseafoods.com.au/&quot;&gt;Hursey Seafoods in Stanley&lt;/a&gt;. The food there was ok but overrated if you ask me. I had flake and chips.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7193.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7193.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;These photos were taken around the lighthouse at Devonport.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/DSCF6638.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/DSCF6638.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/DSCF6661.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/DSCF6661.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;The amazing &lt;a href=&quot;http://antiqueemporium.com.au/&quot;&gt;Antique Emporium&lt;/a&gt; in Devonport.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7215.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7215.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7218.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7218.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;(City Park Radio’s Radio Museum)[https://cityparkradio.com/radio-museum/] in Launceston.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7257.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7257.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Camped at the &lt;a href=&quot;https://longfordriversidecaravanpark.com/&quot;&gt;Londford Riverside Caravan Park&lt;/a&gt; on the last day.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7254.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7254.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7246.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7246.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;We swapped the campervan for a hire car and drove to Hobart. This is
the ginseng and salmon farm at &lt;a href=&quot;https://www.41southtasmania.com/&quot;&gt;41 south&lt;/a&gt;.
Highly recommend their hot smoked salmon.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/DSCF6683.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/DSCF6683.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/DSCF6704.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/DSCF6704.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/DSCF6707.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/DSCF6707.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;This is Red Hills.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7225.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7225.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7222.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7222.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;In Hobart we stayed at the &lt;a href=&quot;https://www.stivesmotel.com.au/&quot;&gt;St Ives Apartments&lt;/a&gt; which is very well located and a short walk to Constitution Dock. I went for an evening walk and came across this Aussie nativity scene.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/DSCF6709.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/DSCF6709.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Picked strawberries and cherries at &lt;a href=&quot;https://www.sorellfruitfarm.com/&quot;&gt;Sorell Fruit Farm&lt;/a&gt;.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7288.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7288.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7291.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7291.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Had lunch at &lt;a href=&quot;https://tasmaniangourmetseafoods.com.au/&quot;&gt;Tasmanian Gourmet Seagoods&lt;/a&gt; which was pretty good.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7296.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7296.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_E7297.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_E7297.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Picked up some local cheese at &lt;a href=&quot;https://hillstreetgrocer.com/&quot;&gt;Hill Street Grocer&lt;/a&gt;.&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7302.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7302.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Best meal of the trip was a &lt;a href=&quot;https://www.blueeye.net.au/menus/&quot;&gt;Blue Eye Seafood&lt;/a&gt; in Hobart. We got there at noon before it was packed.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7308.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7308.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7311.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7311.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7314.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7314.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      Mussels

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7317.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7317.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      Crumbed Tasmanian scallops and seafood linguini

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7319.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7319.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      Chocolate mousse

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Land here is much cheaper than Sydney.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/9DFBB10E-9E72-498E-A31B-41B98D4C2BD9.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/9DFBB10E-9E72-498E-A31B-41B98D4C2BD9.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;On the last night we stayed at the Sebel in Launceston and had a nice breakfast
there.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7332.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7332.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      Egg benedict

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/IMG_7333.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/IMG_7333.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      Poached egg and vegetables

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;</content><author><name>phwl</name></author><category term="travel" /><category term="australia" /><summary type="html">Went to Tasmania for a few days. Last time I was here was 2015.</summary></entry><entry><title type="html">Computer Engineering Lab Christmas Party Photo</title><link href="http://localhost:4000/2020/computer-engineering-lab-christmas-party/" rel="alternate" type="text/html" title="Computer Engineering Lab Christmas Party Photo" /><published>2020-12-01T16:00:00+11:00</published><updated>2020-12-01T16:00:00+11:00</updated><id>http://localhost:4000/2020/computer-engineering-lab-christmas-party</id><content type="html" xml:base="http://localhost:4000/2020/computer-engineering-lab-christmas-party/">&lt;p&gt;A little late this year (and down on numbers due to COVID) but we had an
enjoyable Christmas party.&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/12/celchristmas20.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/12/celchristmas20.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      2020

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;We continue to have the world’s earlier Christmas party!&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2019/11/celchristmas19.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2019/11/celchristmas19.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      2019

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2018/11/DSCF5719.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2018/11/DSCF5719.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      2018

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2017/11/celchristmas17.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2017/11/celchristmas17.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      2017

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2017/11/celchristmas2016.jpg&quot;&gt;
  &lt;img src=&quot;/assets/images/2017/11/celchristmas2016.jpg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      2016

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2017/11/celparty2015.jpg&quot;&gt;
  &lt;img src=&quot;/assets/images/2017/11/celparty2015.jpg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      2015

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2017/11/celchristmas2014.jpg&quot;&gt;
  &lt;img src=&quot;/assets/images/2017/11/celchristmas2014.jpg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      2014

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;</content><author><name>phwl</name></author><category term="academia" /><category term="celchristmas" /><summary type="html">A little late this year (and down on numbers due to COVID) but we had an enjoyable Christmas party.</summary></entry><entry><title type="html">Albacore Ubuntu GPU Machine Install</title><link href="http://localhost:4000/2020/albacore-configuration/" rel="alternate" type="text/html" title="Albacore Ubuntu GPU Machine Install" /><published>2020-11-23T14:45:42+11:00</published><updated>2020-11-23T14:45:42+11:00</updated><id>http://localhost:4000/2020/albacore-configuration</id><content type="html" xml:base="http://localhost:4000/2020/albacore-configuration/">&lt;p&gt;This is how a new machine, albacore, was configured.&lt;/p&gt;

&lt;h2 id=&quot;machine&quot;&gt;Machine&lt;/h2&gt;
&lt;p&gt;The machine was purchased from &lt;a href=&quot;http://mwave.com.au&quot;&gt;Mwave&lt;/a&gt;. I’ve purchased a few machines from them and always impressed with their service. Here is the configuration&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;AB47402 Mwave Custom PC Assembly and Testing Service 2 $169.00 $338.00
AB59620 SilverStone Sugo Series SG13 Mini ITX Case - Mesh Front Panel 2 $69.00 $138.00
AB69770 Corsair Vengeance LPX 32GB (2x 16GB) DDR4 3200MHz Memory 2 $209.00 $418.00
AC12989 Seagate ST8000DM004 8TB BarraCuda 3.5&quot; SATA3 Desktop Hard Drive 2 $249.00 $498.00
AC13202 Samsung 970 EVO 1TB NVMe 1.3 M.2 (2280) 3D V-NAND SSD - MZ-V7E1T0BW 2 $189.00 $378.00
AC17689 Noctua NF-A12x25 FLX 120mm 3-Pin Fan 2 $65.00 $130.00
AC24743 AMD Ryzen 5 3600 6 Core Socket AM4 3.6GHz CPU Processor + Wraith Stealth Cooler 2 $319.00 $638.00
AC27759 SilverStone SX700-PT 700W 80+ Platinum Modular SFX Power Supply 2 $249.00 $498.00
AC35557 Gigabyte B550I AORUS PRO AX AM4 Mini-ITX Motherboard 2 $319.00 $638.00
AC25330 Gigabyte GeForce RTX 2060 SUPER WINDFORCE OC 8GB Video Card 2 $629.00 $1258.00

Order Status: Completed Sub-Total $4932.00
Date &amp;amp; Time Shipped: 19/11/2020 Shipping Cost $30.00
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the &lt;a href=&quot;https://www.gigabyte.com/Motherboard/B550I-AORUS-PRO-AX-rev-10/support#support-manual&quot;&gt;motherboard manual&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;step-1-wifi-and-fix-ethernet&quot;&gt;Step 1 Wifi and Fix Ethernet&lt;/h2&gt;
&lt;p&gt;To connect to the University of Sydney wifi&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Security: WPA &amp;amp; WPA2 Enterprise
Authentication: Protected EAP (PEAP)
Anonymous identity:&amp;lt;blank&amp;gt;
CA certificate: (None) - Check &quot;No CA certificate is required&quot;
PEAP version: Automatic
Inner authentication: MSCHAPv2
Username: &amp;lt;unikey&amp;gt; 
Password: &amp;lt;password&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt update
sudo apt upgrade
sudo apt install openssh-server net-tools rclone libelf-dev build-essential
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ethernet didn’t work out of the box so I used a USB ethernet device and 
installed the realtek driver for the B550 chipset available
from &lt;a href=&quot;https://www.realtek.com/en/component/zoo/category/network-interface-controllers-10-100-1000m-gigabit-ethernet-pci-express-software&quot;&gt;Realtek&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;step-2-install-cuda&quot;&gt;Step 2 Install cuda&lt;/h2&gt;
&lt;p&gt;Then follow the &lt;a href=&quot;https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html&quot;&gt;Nvidia instructions&lt;/a&gt;
using the Package Manager method and deb(network) installer type. This doesn’t quite work as you need to do a&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt purge nvidia-*
sudo apt autoremove
sudo ubuntu-drivers autoinstall
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;before installing cuda&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt install cuda=10.2.89-1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.profile&lt;/code&gt; add&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;export PATH=/usr/local/cuda/bin${PATH:+:${PATH}}
export LD_LIBRARY_PATH=/usr/local/cuda-10.2/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step-3-install-anacondapytorch&quot;&gt;Step 3 Install anaconda/pytorch&lt;/h2&gt;
&lt;p&gt;Install &lt;a href=&quot;https://www.anaconda.com/products/individual&quot;&gt;anaconda&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget https://repo.anaconda.com/archive/Anaconda3-2020.07-Linux-x86_64.sh
sh Anaconda3-2020.07-Linux-x86_64.sh
conda install pytorch torchvision cudatoolkit=10.2 -c pytorch
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seems to work&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(base) cruxml@amberjack:~$ cat /proc/driver/nvidia/version
NVRM version: NVIDIA UNIX x86_64 Kernel Module  450.51.06  Sun Jul 19 20:02:54 UTC 2020
GCC version:  gcc version 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04) 
(base) cruxml@amberjack:~$ python
Python 3.8.3 (default, Jul  2 2020, 16:21:59) 
[GCC 7.3.0] :: Anaconda, Inc. on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; import torch
&amp;gt;&amp;gt;&amp;gt; torch.cuda.current_device()
0
&amp;gt;&amp;gt;&amp;gt; torch.cuda.device(0)
&amp;lt;torch.cuda.device object at 0x7fa9a5fab310&amp;gt;
&amp;gt;&amp;gt;&amp;gt; torch.cuda.get_device_name(0)
'GeForce RTX 2060 SUPER'
&amp;gt;&amp;gt;&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step-4-install-docker&quot;&gt;Step 4 Install docker&lt;/h2&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt update

sudo apt install docker.io
sudo systemctl start docker
sudo systemctl enable docker
sudo usermod -aG docker cruxml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You need to log out and log in again for the group change to work.&lt;/p&gt;

&lt;h2 id=&quot;step-5-install-other-stuff&quot;&gt;Step 5 Install other stuff&lt;/h2&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt install hddtemp lm-sensors nvme-cli
sudo sensors-detect --auto # unfortunately didn't find anything!
sudo add-apt-repository universe
sudo apt update
sudo apt install exfat-fuse exfat-utils
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step-6-vivado&quot;&gt;Step 6 Vivado&lt;/h2&gt;
&lt;p&gt;Installed Vitis&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo sh Xilinx_Unified_2019.2_1106_2127_Lin64.bin
# installed to /opt instead of /tools
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The following &lt;em&gt;did not&lt;/em&gt; work:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt install ./xrt_201920.2.3.1301_18.04-xrt.deb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So I installed XRT from the instructions &lt;a href=&quot;https://xilinx.github.io/XRT/master/html/build.html&quot;&gt;https://xilinx.github.io/XRT/master/html/build.html&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Following &lt;a href=&quot;https://www.hackster.io/AlbertaBeef/vitis-ai-1-1-flow-for-avnet-vitis-platforms-part-1-007b0e&quot;&gt;https://www.hackster.io/AlbertaBeef/vitis-ai-1-1-flow-for-avnet-vitis-platforms-part-1-007b0e&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HOME=$HOME
export VITIS_AI_HOME=$HOME/src/xilinx/Vitis-AI
export SDX_PLATFORM=$HOME/src/xilinx/ULTRA96V2/ULTRA96V2.xpfm
export TRD_HOME=$VITIS_AI_HOME/DPU-TRD-ULTRA96V2
cd /opt/Xilinx/Vitis/2019.2
source settings64.sh
cd /opt/xilinx/xrt
source setup.sh
cd $TRD_HOME/prj/Vitis
# make KERNEL=DPU DEVICE=ULTRA96V2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step-7-install-balena-etcher&quot;&gt;Step 7 Install Balena Etcher&lt;/h2&gt;
&lt;p&gt;Follow instructions at &lt;a href=&quot;https://www.balena.io/etcher/&quot;&gt;https://www.balena.io/etcher/&lt;/a&gt;&lt;/p&gt;</content><author><name>phwl</name></author><category term="academia" /><category term="software" /><category term="ubuntu" /><summary type="html">This is how a new machine, albacore, was configured.</summary></entry><entry><title type="html">Googong Dam</title><link href="http://localhost:4000/2020/googong-dam/" rel="alternate" type="text/html" title="Googong Dam" /><published>2020-11-21T06:24:10+11:00</published><updated>2020-11-21T06:24:10+11:00</updated><id>http://localhost:4000/2020/googong-dam</id><content type="html" xml:base="http://localhost:4000/2020/googong-dam/">&lt;p&gt;Barry and I were in Canberra on a &lt;a href=&quot;http://www.cruxml.com&quot;&gt;CruxML&lt;/a&gt; business trip and
had a quick fish in &lt;a href=&quot;https://en.wikipedia.org/wiki/Googong_Dam&quot;&gt;Googong Dam&lt;/a&gt;.&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/11/IMG_7089.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/11/IMG_7089.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Didn’t catch the Golden Perch that we were after but caught a few Redfin Perch.&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/11/IMG_7078.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/11/IMG_7078.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/11/IMG_7087.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/11/IMG_7087.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/11/d75f8ee1-fe34-4ab8-bbfc-732316c4c488.jpg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/11/d75f8ee1-fe34-4ab8-bbfc-732316c4c488.jpg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;</content><author><name>phwl</name></author><category term="fishing" /><summary type="html">Barry and I were in Canberra on a CruxML business trip and had a quick fish in Googong Dam.</summary></entry><entry><title type="html">Luks Encryption under Ubuntu</title><link href="http://localhost:4000/2020/luks-encryption/" rel="alternate" type="text/html" title="Luks Encryption under Ubuntu" /><published>2020-11-13T10:51:57+11:00</published><updated>2020-11-13T10:51:57+11:00</updated><id>http://localhost:4000/2020/luks-encryption</id><content type="html" xml:base="http://localhost:4000/2020/luks-encryption/">&lt;h1 id=&quot;copy-a-luks-volume&quot;&gt;Copy a LUKS volume&lt;/h1&gt;
&lt;p&gt;This is how to copy a LUKS partition from back1 to back2. 
We assume the original device is already opened using:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cryptsetup luksOpen /dev/disk/by-uuid/dc861b6d-0113-4da8-9c74-23fb1e759195 back1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;First create a LUKS partition (back2 on /dev/sdc1)&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Repartition drive with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo fdisk /dev/sdc&lt;/code&gt; as a linux partition&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo cryptsetup luksFormat /dev/sdc1&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Open the new LUKS device and copy data&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo cryptsetup luksOpen /dev/sdc1 back2
sudo mkfs.ext4 /dev/mapper/back2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Close everything so we can start from scratch for the copying:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cryptsetup luksClose /dev/mapper/back1
cryptsetup luksClose /dev/mapper/back2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;copying&quot;&gt;Copying&lt;/h1&gt;
&lt;p&gt;Find UUIDS using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;blkid&lt;/code&gt;, then&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cryptsetup luksOpen /dev/disk/by-uuid/dc861b6d-0113-4da8-9c74-23fb1e759195 back1
cryptsetup luksOpen /dev/disk/by-uuid/b6e6191b-673a-49c2-87b0-7a1a2d880bb1 back2
mount /dev/mapper/back1 /srv/back1
mount /dev/mapper/back2 /srv/back2
nohup rsync -Phav /srv/back1/ /srv/back2&amp;amp;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;mounting&quot;&gt;Mounting&lt;/h1&gt;
&lt;h2 id=&quot;ubuntu&quot;&gt;Ubuntu&lt;/h2&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cryptsetup luksOpen /dev/disk/by-uuid/b6e6191b-673a-49c2-87b0-7a1a2d880bb1 back2
mount /dev/mapper/back2 /srv/back2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;windows-using-ubuntu-in-hyper-v&quot;&gt;Windows using Ubuntu in Hyper-V.&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;The trick here is you need to right click -&amp;gt; Disk Management -&amp;gt; (take drive offline).&lt;/li&gt;
  &lt;li&gt;Then in Hyper-V, you go to Setting -&amp;gt; SCSI-Controller -&amp;gt; (add the drive as a physical drive)&lt;/li&gt;
  &lt;li&gt;Use an External Virtual Switch to put the machine on the same subnet as your host and samba to share the drive&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;macos-using-ubuntu-in-vmware&quot;&gt;MacOS using Ubuntu in VMWare&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;It took me a long time to figure out that you can only pass through the disk as a USB 3.0 disk and have to install Guest Additions from Preferences on VMWare.&lt;/li&gt;
  &lt;li&gt;Use an Bridged Adapter to put the machine on the same subnet as your host and samba to share the drive&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;mounting-1&quot;&gt;Mounting&lt;/h1&gt;
&lt;p&gt;You can mount the shared drive from a Ubuntu machine as follows&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mount -t cifs //phwlnuc/back2 /srv/back2 -v -o username=phwl,uid=$(id -u),gid=$(id -g),iocharset=utf8,vers=3.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h1 id=&quot;closing&quot;&gt;Closing&lt;/h1&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;umount /srv/back1
umount /srv/back2
cryptsetup luksClose /dev/mapper/back1
cryptsetup luksClose /dev/mapper/back2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>phwl</name></author><category term="software" /><category term="ubuntu" /><category term="linux" /><summary type="html">Copy a LUKS volume This is how to copy a LUKS partition from back1 to back2. We assume the original device is already opened using: cryptsetup luksOpen /dev/disk/by-uuid/dc861b6d-0113-4da8-9c74-23fb1e759195 back1</summary></entry><entry><title type="html">Lake Copeton Fishing for Murray Cod and Golden Perch</title><link href="http://localhost:4000/2020/lake-copeton-murray-cod/" rel="alternate" type="text/html" title="Lake Copeton Fishing for Murray Cod and Golden Perch" /><published>2020-10-13T21:30:14+11:00</published><updated>2020-10-13T21:30:14+11:00</updated><id>http://localhost:4000/2020/lake-copeton-murray-cod</id><content type="html" xml:base="http://localhost:4000/2020/lake-copeton-murray-cod/">&lt;p&gt;Drove with Beard for 16 hours for 10 hours fishing at Lake Inverell.&lt;/p&gt;

&lt;!-- more --&gt;
&lt;p&gt;We had booked a day of guiding with Murray cod expert &lt;a href=&quot;https://www.instagram.com/fishing_with_usher__guide/&quot;&gt;Josh Usher&lt;/a&gt;. Fortunately, he had the next day off so we exchange our day for two mornings, starting at 3:30am. We could see an amazing number of stars at the lake.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_1861.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_1861.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;The first morning there were plenty of fish about and we marked about 20 large cod over a meter on the sidescan fish finder. The boat was in 7ft of water and the fish were on the bank side so they were in very shallow water under the cover of darkness.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_1847.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_1847.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Beard retrieving at sunrise. We were fishing 50lb braid on beautiful Wilson Venom rods.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_1848.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_1848.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Beard hooked the bottom (which was more action I saw).&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_1859.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_1859.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Unfortunately we didn’t get any hits the entire morning.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_1869.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_1869.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;The guiding finished at 7:30am and we were kicking ourselves for not bringing our fishing gear (we thought we’d be fishing with Josh the entire day and returning to Sydney the next). Josh very kindly loaned us a couple of rods and a box of lures.&lt;/p&gt;

&lt;p&gt;Left to our own devices, we fished the Macintyre River near the caravan park in Inverell that morning. Very soon, Beard caught a very nice golden perch (also known as yellowbelly) on a 60mm Harima Mazzy vibe. It hit his lure on each of the previous two casts and he hooked up on the third.&lt;/p&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6779.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6779.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6780.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6780.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6785.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6785.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6795.jpg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6795.jpg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Then I got a Murray cod.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6788.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6788.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6794.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6794.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;After a nap, we went to Lake Inverell. I stupidly put a lure with three barbed trebles on my fleece jacket and it took two people, tape and a pair of pliers to unhook. Then I lost the lure I wanted to replace it with. Beard found it stuck to my fleece!&lt;/p&gt;

&lt;p&gt;We saw this mother duck with its ducklings in the river below the dam.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6799.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6799.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Also fished the lake without success.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6801.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6801.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6803.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6803.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Went back to the Macintyre and after an hour of flogging, Beard picked up a cod.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6809.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6809.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Then I got a smaller perch which absolutely smashed the lure.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6811.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6811.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Next morning, went out with Josh again but this time we only saw 2 fish on the sounder. Again, didn’t get a touch. Here is Josh retreiving his Polycraft polyethylene boat.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/E12A022B-E0BD-48FF-81DE-7C2DBD212B20-1860-000000DEDBB9CE19.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/E12A022B-E0BD-48FF-81DE-7C2DBD212B20-1860-000000DEDBB9CE19.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;On the way back, we stopped at the &lt;a href=&quot;https://www.facebook.com/thegoldfishbowlbakery/&quot;&gt;Goldfish Bowl&lt;/a&gt;. This is my favourite bakery and coffee shop in Armidale.&lt;/p&gt;
&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6820.jpeg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6820.jpeg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;figure class=&quot;&quot;&gt;
  &lt;a href=&quot;/assets/images/2020/10/IMG_6821.jpg&quot;&gt;
  &lt;img src=&quot;/assets/images/2020/10/IMG_6821.jpg&quot; alt=&quot;&quot; /&gt;
  
    &lt;figcaption&gt;
      

    &lt;/figcaption&gt;&lt;/a&gt;&lt;/figure&gt;

&lt;p&gt;Although we would have liked a 135cm cod like &lt;a href=&quot;https://www.northerndailyleader.com.au/story/6428962/absolute-monster-josh-usher-lands-humongous-murray-cod/&quot;&gt;this one that Josh caught&lt;/a&gt;, we did learn a lot from him and he’s a great guide. In a way, it is good that things were not that easy. I’ll try again soon, maybe take the boat up there for a week.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://nnimgt-a.akamaihd.net/transform/v1/crop/frm/iViHsQkuwAs9FXZ3pcZDd6/e9a67f97-cc8a-4a1b-8fe2-2270a32b4644.jpg/r0_0_764_480_w1200_h678_fmax.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;</content><author><name>phwl</name></author><category term="fishing" /><category term="australia" /><summary type="html">Drove with Beard for 16 hours for 10 hours fishing at Lake Inverell.</summary></entry><entry><title type="html">Amberjack Ubuntu GPU Machine Install</title><link href="http://localhost:4000/2020/amberjack-configuration/" rel="alternate" type="text/html" title="Amberjack Ubuntu GPU Machine Install" /><published>2020-10-09T19:54:42+11:00</published><updated>2020-10-09T19:54:42+11:00</updated><id>http://localhost:4000/2020/amberjack-configuration</id><content type="html" xml:base="http://localhost:4000/2020/amberjack-configuration/">&lt;p&gt;This is how a new machine, amberjack, was configured.&lt;/p&gt;

&lt;h2 id=&quot;machine&quot;&gt;Machine&lt;/h2&gt;
&lt;p&gt;The machine was purchased from &lt;a href=&quot;http://mwave.com.au&quot;&gt;Mwave&lt;/a&gt;. I’ve purchased a few machines from them and always impressed with their service. Here is the configuration&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;AC16427	MSI B450I GAMING PLUS AC AM4 Mini-ITX Motherboard				1	1	$225.00	$225.00
AB83276	SilverStone Strider Essential ST60F-ES230 600W 80 Plus Power Supply		1	1	$75.00	$75.00
AC19487	Crucial P1 500GB NVMe M.2 PCIe 3D NAND SSD CT500P1SSD8				1	1	$89.00	$89.00
AC23360	Respawn Ninja x MWAVE Gaming Mouse Pad Small - Black				1	1	$1.00	$1.00
AB47402	Mwave Custom PC Assembly and Testing Service					1	1	$199.00	$199.00
AB52361	Advanced Transportation Packing Solution					1	1	$19.99	$19.99
AC26501	Kingston HyperX FURY RGB 32GB (2x 16GB) DDR4 3200MHz Memory			1	1	$209.00	$209.00
AC29726	ASUS GeForce RTX 2060 SUPER Turbo EVO 8GB Video Card				1	1	$649.00	$649.00
AC12989	Seagate ST8000DM004 8TB BarraCuda 3.5&quot; SATA3 Desktop Hard Drive			1	1	$299.00	$299.00
AB64976	Windows 10 Professional 64-bit OEM DVD						1	1	$219.00	$219.00
AB59620	SilverStone Sugo Series SG13 Mini ITX Case - Mesh Front Panel			1	1	$69.00	$69.00
AC24744	AMD Ryzen 5 3600X 6 Core Socket AM4 3.8GHz CPU Processor + Wraith Spire Cooler	1	1	$369.00	$369.00

Total of Invoice Inc GST $2,490.33
Total GST $226.39
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the &lt;a href=&quot;https://download.msi.com/archive/mnu_exe/mb/E7A40v2.2.pdf&quot;&gt;motherboard manual&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;step-1-update-bios-to-enable-virtualisation&quot;&gt;Step 1 Update BIOS to enable virtualisation&lt;/h2&gt;
&lt;p&gt;In the BIOS settings set&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Overclocking -&amp;gt; OC Explore Mode -&amp;gt; Expert
Overclocking -&amp;gt; CPU Features -&amp;gt; SVM Mode -&amp;gt; Enable
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then boot machine (into Windows 10).&lt;/p&gt;

&lt;h2 id=&quot;step-2-install-ubuntu&quot;&gt;Step 2 Install Ubuntu&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;Erase disk and install everything to /dev/nvme0n1. Select LVM.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;step-3-move-opt-var-home-to-hard-disk&quot;&gt;Step 3 Move /opt /var /home to hard disk&lt;/h2&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo -i
mkdir /srv; mkdir /src/fs
mount /dev/sda1 /srv/fs
rsync -aXP /opt /var /home /srv/fs
cd /
mv opt opt.old
mv var var.old
mv home home.old
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Add the mounts to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/fstab&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mount the local HD to /home, /var and /opt
/dev/disk/by-uuid/HARD_DISK /srv/fs auto nodev,nofail,x-gvfs-show 0 0
/srv/fs/home	/home	none	bind	0	0
/srv/fs/var	/var	none	bind	0	0
/srv/fs/opt	/opt	none	bind	0	0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and reboot. After it reboots successfully you can&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo rm -rf /opt.old /home.old /var.old
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step-4-install-cuda&quot;&gt;Step 4 Install cuda&lt;/h2&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt update
sudo apt upgrade
sudo apt install openssh-server net-tools rclone
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then follow the &lt;a href=&quot;https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html&quot;&gt;Nvidia instructions&lt;/a&gt;
using the Package Manager method and deb(network) installer type. This doesn’t quite work as you need to do a&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt purge nvidia-*
sudo apt autoremove
sudo ubuntu-drivers autoinstall
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;before installing cuda&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt install cuda=10.2.89-1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.profile&lt;/code&gt; add&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;export PATH=/usr/local/cuda/bin${PATH:+:${PATH}}
export LD_LIBRARY_PATH=/usr/local/cuda-10.2/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step-5-install-anacondapytorch&quot;&gt;Step 5 Install anaconda/pytorch&lt;/h2&gt;
&lt;p&gt;Install &lt;a href=&quot;https://www.anaconda.com/products/individual&quot;&gt;anaconda&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget https://repo.anaconda.com/archive/Anaconda3-2020.07-Linux-x86_64.sh
sh Anaconda3-2020.07-Linux-x86_64.sh
conda install pytorch torchvision cudatoolkit=10.2 -c pytorch
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seems to work&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(base) cruxml@amberjack:~$ cat /proc/driver/nvidia/version
NVRM version: NVIDIA UNIX x86_64 Kernel Module  450.51.06  Sun Jul 19 20:02:54 UTC 2020
GCC version:  gcc version 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04) 
(base) cruxml@amberjack:~$ python
Python 3.8.3 (default, Jul  2 2020, 16:21:59) 
[GCC 7.3.0] :: Anaconda, Inc. on linux
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; import torch
&amp;gt;&amp;gt;&amp;gt; torch.cuda.current_device()
0
&amp;gt;&amp;gt;&amp;gt; torch.cuda.device(0)
&amp;lt;torch.cuda.device object at 0x7fa9a5fab310&amp;gt;
&amp;gt;&amp;gt;&amp;gt; torch.cuda.get_device_name(0)
'GeForce RTX 2060 SUPER'
&amp;gt;&amp;gt;&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step-6-install-docker&quot;&gt;Step 6 Install docker&lt;/h2&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt update

sudo apt install docker.io
sudo systemctl start docker
sudo systemctl enable docker
sudo usermod -aG docker cruxml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You need to log out and log in again for the group change to work.&lt;/p&gt;

&lt;h2 id=&quot;step-7-install-other-stuff&quot;&gt;Step 7 Install other stuff&lt;/h2&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt install hddtemp lm-sensors nvme-cli
sudo sensors-detect --auto # unfortunately didn't find anything!
sudo add-apt-repository universe
sudo apt update
sudo apt install exfat-fuse exfat-utils
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step-8-vivado&quot;&gt;Step 8 Vivado&lt;/h2&gt;
&lt;p&gt;Installed Vitis&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo sh Xilinx_Unified_2019.2_1106_2127_Lin64.bin
# installed to /opt instead of /tools
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The following &lt;em&gt;did not&lt;/em&gt; work:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo apt install ./xrt_201920.2.3.1301_18.04-xrt.deb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So I installed XRT from the instructions &lt;a href=&quot;https://xilinx.github.io/XRT/master/html/build.html&quot;&gt;https://xilinx.github.io/XRT/master/html/build.html&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Following &lt;a href=&quot;https://www.hackster.io/AlbertaBeef/vitis-ai-1-1-flow-for-avnet-vitis-platforms-part-1-007b0e&quot;&gt;https://www.hackster.io/AlbertaBeef/vitis-ai-1-1-flow-for-avnet-vitis-platforms-part-1-007b0e&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HOME=$HOME
export VITIS_AI_HOME=$HOME/src/xilinx/Vitis-AI
export SDX_PLATFORM=$HOME/src/xilinx/ULTRA96V2/ULTRA96V2.xpfm
export TRD_HOME=$VITIS_AI_HOME/DPU-TRD-ULTRA96V2
cd /opt/Xilinx/Vitis/2019.2
source settings64.sh
cd /opt/xilinx/xrt
source setup.sh
cd $TRD_HOME/prj/Vitis
# make KERNEL=DPU DEVICE=ULTRA96V2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step-9-install-balena-etcher&quot;&gt;Step 9 Install Balena Etcher&lt;/h2&gt;
&lt;p&gt;Follow instructions at &lt;a href=&quot;https://www.balena.io/etcher/&quot;&gt;https://www.balena.io/etcher/&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-xx-decided-against-running-ubuntu-under-windows-10&quot;&gt;Step XX (Decided against running ubuntu under windows 10)&lt;/h2&gt;

&lt;p&gt;How to set up Ubuntu 18.04 under Hyper-V&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Right click on the Windows button and select ‘Apps and Features’.&lt;/li&gt;
  &lt;li&gt;Select Programs and Features on the right under related settings.&lt;/li&gt;
  &lt;li&gt;Select Turn Windows Features on or off.&lt;/li&gt;
  &lt;li&gt;Select Hyper-V and click OK.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I then mounted my home samba shared disk:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;In File explorer, right click on the PC -&amp;gt; Add a Network Location -&amp;gt; \machinename\back1&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Then install Ubuntu.&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;In Hyper-V manager (Quick create).&lt;/li&gt;
  &lt;li&gt;I wanted the virtual hard disk to be on the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;E:&lt;/code&gt; drive. Edit the settings of the VM and edit the
Virtual Hard Disk” to convert the image from
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Users\Public\Public Documents\Hyper-V\Virtual Hard Disks&lt;/code&gt; to
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;E:\srv\amberjack\hyperv\ubuntu-hd1&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Don’t upgrade to 20.04!&lt;/p&gt;</content><author><name>phwl</name></author><category term="academia" /><category term="software" /><category term="ubuntu" /><summary type="html">This is how a new machine, amberjack, was configured.</summary></entry></feed>